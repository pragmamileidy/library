--- 
id: 2922
name: Paso 1 - Ingresar tipo de Solicitante y de Solicitud
label: Ingresar tipo de Solicitante y de Solicitud
description: ""
fill_step_id: 1566
created_at: 2014-06-28 14:25:15 Z
updated_at: 2014-06-28 14:25:15 Z
include: "{\"4414\":{\"3263\":{\"3702\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3698\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"3210\":{\"3628\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"3211\":{\"3627\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3690\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"3213\":{\"2929\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"2930\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3631\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"4415\":{\"3212\":{\"3629\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3630\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"4425\":{\"1710\":{\"1401\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4426\":{\"1710\":{\"1401\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"disabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,close,close_and_save,save
on_becoming: "# Inicializacion de datos generales\r\n\
  \r\n\
  form_data.set(\"informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud\",@application[\"created_at\"])\r\n\
  result = WebserviceConsumer.get( '/consecutive/generador_css_crtcu/generate.json').parsed_response\r\n\
  _consecutivo = result[\"response\"]\r\n\
  _consecutivo = \"#{@application[\"id\"]}-\"+\"#{_consecutivo[\"value\"]}\"\r\n\
  form_data.set(\"informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud\",_consecutivo)\r\n\
  \r\n\
  \r\n\
  if  @owner[\"kind_of_user_type\"] == \"JuridicalPerson\"\r\n\
  \t_ruc = @owner[\"tax_id\"]\r\n\
  \r\n\
  \tform_data.set(\"datos_del_solicitante_persona_juridica.datos_persona_juridica.ruc\",_ruc)\r\n\
  \tform_data.set(\"datos_del_solicitante_persona_juridica.datos_persona_juridica.nombre\",@owner[\"name\"])\r\n\
  \tform_data.set(\"datos_del_solicitante_persona_juridica.datos_de_ubicacion.numero_de_telefono\",@owner[\"fixed_number\"])\r\n\
  \tform_data.set(\"datos_del_solicitante_persona_juridica.datos_de_ubicacion.correo_electronico\",@owner[\"email\"])\r\n\
  \tform_data.set(\"datos_del_solicitante_persona_juridica.datos_de_ubicacion.direccion\",@owner[\"full_address\"])\r\n\
  end\r\n\
  \r\n\
  if @owner[\"kind_of_user_type\"] == \"NaturalPerson\"\r\n   form_data.set(\"tipo_de_persona_dij.pregunta.cedula\",  \"#{@owner[\"national_id\"]}\"+\"#{@owner[\"passport\"]}\")\r\n\
  end\r\n\
  \r\n         "
on_transition: "###################Datos del Solicitante Natural\r\n\
  if @owner[\"kind_of_user_type\"] == \"NaturalPerson\"\r\n\
  \tif @owner[\"natural_person_type\"]==\"national_citizen\"\r\n\
  \t\tnro_documento=@owner[\"national_id\"]\r\n        tipo_documento=\"Cedula\"\r\n\
  \t\tdato=\"true\"\r\n\
  \t\tresult = WebserviceConsumer.get('/service/bdin_dij_datos_vigentes/find.json?tipoDocumento=CIP&nroDocumento=' + \"#{nro_documento}\").parsed_response\r\n        _solicitante = result[\"response\"]\r\n\
  \t\trecord = _solicitante[\"recordVigente\"]\r\n\
  \t\tcurso = _solicitante[\"recordCurso\"]\r\n\
  \t\tif record == \"true\"\r\n\
  \t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.cedula_pasaporte\",\"\")\r\n\
  \t\t\trp_vigente = _solicitante[\"recordVigente\"]\r\n\
  \t\t\tif rp_vigente == \"true\"\r\n\
  \t\t\t\tvigente = \"Record Vigente\"\r\n\
  \t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.campo_oculto\",vigente)\r\n\
  \t\t\tend\r\n\
  \t\tend\r\n\
  \t\tif curso == \"true\"\r\n\
  \t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.cedula_pasaporte\",\"\")\r\n\
  \t\t\trp_curso = _solicitante[\"recordCurso\"]\r\n\
  \t\t\tif rp_curso == \"true\"\r\n\
  \t\t\t\tcurso = \"Record en Curso\"\r\n\
  \t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.campo_oculto\",curso)\r\n\
  \t\t\tend\r\n\
  \t\tend\r\n\
  \t\r\n    \t\tresult = WebserviceConsumer.get( '/service/bdin_tribunal_electoral/find.json?cedula=' + \"#{nro_documento}\").parsed_response\r\n    \t\t data = result[\"response\"]\r\n\
  \t\t\t\tif data.nil? \r\n\
  \t\t\t\t\ttransition_errors << \"Los datos del solicitante no fueron encontrados, por favor verifique.\"\r\n\
  \t\t\t\telse\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.tipo_documento\",tipo_documento)\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.cedula_pasaporte\",data[\"cedula\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.primer_nombre\",data[\"primerNombre\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.segundo_nombre\",data[\"segundoNombre\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.primer_apellido\",data[\"primerApellido\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.segundo_apellido\",data[\"segundoApellido\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.apellido_de_casada\",data[\"apellidoCasada\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_de_ubicacion.direccion\",data[\"direccionNacimiento\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_de_ubicacion.numero_de_telefono\",data[\"tlfLocal\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_de_ubicacion.correo_electronico\",data[\"email\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_de_ubicacion.pais\",data[\"pais\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_padre_instance_1.datos_de_la_persona.primer_nombre\",data[\"primerNombrePadre\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_padre_instance_1.datos_de_la_persona.primer_apellido\",data[\"apellidoPaternoPadre\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_de_la_madre_instance_1.datos_de_la_persona.primer_nombre\",data[\"primerNombreMadre\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_de_la_madre_instance_1.datos_de_la_persona.primer_apellido\",data[\"apellidoPaternoMadre\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_padre_instance_1.datos_de_la_persona.documento_hijo\",nro_documento)\r\n\
  \t\t\t\t\tform_data.set(\"datos_de_la_madre_instance_1.datos_de_la_persona.documento_hijo\",nro_documento)\r\n\
  \t\t\t\t\tfecha = data[\"fechaNacimiento\"]\r\n\
  \t\t\t\t\tfecha_n = Time.parse(fecha).strftime(\"%d-%m-%Y\")\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.fecha_de_nacimiento\",fecha_n)\r\n\
  \r\n\
  \t\t\t\t\tedad = ((Date.today - fecha_n.to_date).to_f / 365).to_i\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.edad\",edad)\r\n\
  \t\t\tend        \r\n    \r\n\
  \telse\r\n\
  \t\tnro_documento=@owner[\"passport\"]\r\n\
  \t\ttipo_documento=\"Pasaporte\"\t\r\n\
  \t\tresult = WebserviceConsumer.get('/service/bdin_dij_datos_vigentes/find.json?tipoDocumento=PAS&nroDocumento=' + \"#{nro_documento}\").parsed_response\r\n        _solicitante = result[\"response\"]\r\n\
  \t\trecord=_solicitante[\"recordVigente\"]\r\n\
  \t\tif record == \"true\"\r\n\
  \t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.tipo_documento\",tipo_documento)\r\n\
  \t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.cedula_pasaporte\",nro_documento)\r\n\
  \t\t\tform_data.set(\"datos_del_padre_instance_instance_1.datos_de_la_persona.documento_hijo\",nro_documento)\r\n\
  \t\t\tform_data.set(\"datos_de_la_madre_instance_instance_1.datos_de_la_persona.documento_hijo\",nro_documento)\r\n\
  \t\t\t#form_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.primer_nombre\",_solicitante[\"primerNombre\"])\r\n\
  \t\t\t#form_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.segundo_nombre\",_solicitante[\"segundoNombre\"])\r\n\
  \t\t\t#form_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.primer_apellido\",_solicitante[\"primerApellido\"])\r\n\
  \t\t\t#form_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.segundo_apellido\",_solicitante[\"segundoApellido\"])\r\n\
  \t\t\t#form_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.apellido_de_casada\",_solicitante[\"apellidoCasada\"])\r\n\
  \t\t\trp_vigente = _solicitante[\"recordVigente\"]\r\n\
  \t\t\tif rp_vigente == \"true\"\r\n\
  \t\t\t\tvigente = \"SI\"\r\n\
  \t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.campo_oculto\",vigente)\r\n\
  \t\t\telse\r\n\
  \t\t\t\tvigente = \"NO\"\r\n\
  \t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.campo_oculto\",vigente)\r\n\
  \t\t\tend\r\n    \t#else\r\n\
  \t\t\t#dato=\"false\"\r\n            #form_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.cedula_pasaporte\",nro_documento)\r\n\
  \t\t\t#form_data.set(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.tipo_documento\",tipo_documento)\r\n\
  \t\t\t#form_data.set(\"datos_del_padre_instance_instance_1.datos_de_la_persona.documento_hijo\",nro_documento)\r\n\
  \t\t\t#form_data.set(\"datos_de_la_madre_instance_instance_1.datos_de_la_persona.documento_hijo\",nro_documento)\r\n\
  \t\tend\t\t\t\r\n\
  \tend\r\n\
  \t\tform_data.set(\"mensaje_dij.mensaje_dij.rp_vigentes\",dato)\r\n\
  end               \r\n\
  \r\n\
  #Persona Jur\xC3\xADdica\r\n\
  \r\n\
  if  @owner[\"kind_of_user_type\"] == \"JuridicalPerson\" #|| @owner[\"kind_of_user_type\"] == \"NaturalPerson\"\r\n   _ruc = @owner[\"tax_id\"]\r\n\
  \tdato=\"true\"\r\n (1..20).each do |x|\r\n    tipo_documento= form_data.get(\"tipo_de_persona_dij.tipo_de_identificacion_instance_#{x}.tipo_identificacion\")\r\n\
  \tnro_documento=form_data.get(\"tipo_de_persona_dij.tipo_de_identificacion_instance_#{x}.numero_documento\")\r\n\
  \tif ( !nro_documento.blank? && !tipo_documento.blank?)\r\n\
  \t\t\tif tipo_documento==\"Cedula\"\r\n\
  \t\t\t\tresult = WebserviceConsumer.get('/service/bdin_dij_datos_vigentes/find.json?tipoDocumento=CIP&nroDocumento=' + \"#{nro_documento}\").parsed_response\r\n\
  \t\t\t\t_solicitante = result[\"response\"]\r\n\
  \t\t\t\trecord=_solicitante[\"recordVigente\"]\r\n\
  \t\t\t\tif record==\"true\"\r\n\
  \t\t\t\t\t#form_data.set(\"mensaje_dij.mensaje_dij.tramite_en_curso\",dato)\r\n\
  \t\t\t\t\tform_data.set(\"tipo_de_persona_dij.tipo_de_identificacion_instance_#{x}.numero_documento\",\"\")\t\r\n\
  \t\t\t\t\ttransition_errors << \" Existe un record policivo vigente o en tr\xC3\xA1mite para el solicitante #{x}, no puede continuar con la solicitud.\"\r\n\
  \t\t\t\t\telse\r\n\
  \t\t\t\t\t\tdato=\"false\"\r\n\
  \t\t\t\tend\r\n\
  \t\t\telse                                       \r\n\
  \t\t\t\tresult = WebserviceConsumer.get('/service/bdin_dij_datos_vigentes/find.json?tipoDocumento=PAS&nroDocumento=' + \"#{nro_documento}\").parsed_response\r\n\
  \t\t\t\t_solicitante = result[\"response\"]\r\n\
  \t\t\t\trecord=_solicitante[\"recordVigente\"]\r\n\
  \t\t\t\tif record==\"true\"\r\n\
  \t\t\t\t\t#form_data.set(\"mensaje_dij.mensaje_dij.tramite_en_curso\",dato)\r\n\
  \t\t\t\t\tform_data.set(\"tipo_de_persona_dij.tipo_de_identificacion_instance_#{x}.numero_documento\",\"\") \r\n\
  \t\t\t\t\ttransition_errors << \" Existe un record policivo vigente o en tr\xC3\xA1mite para el solicitante #{x}, no puede continuar con la solicitud.\"\r\n\
  \t\t\t\t\telse\r\n\
  \t\t\t\t\t\tdato=\"false\"\r\n\
  \t\t\t\tend\r\n\
  \t\t\tend    \r\n\
  \t\t\t#form_data.set(\"mensaje_dij.mensaje_dij.tramite_en_curso\",dato)\r\n\
  \t\t\t\tif tipo_documento==\"Cedula\"\r\n\
  \t\t\t\t\t\tresult = WebserviceConsumer.get( '/service/bdin_tribunal_electoral/find.json?cedula=' + \"#{nro_documento}\").parsed_response\r\n\
  \t\t\t\t\t\tdata = result[\"response\"]\r\n\
  \t\t\t\t\t\tif data.blank?\r\n\
  \t\t\t\t\t\t\tform_data.set(\"tipo_de_persona_dij.tipo_de_identificacion_instance_#{x}.numero_documento\",\"\")\t\t\t\t\r\n\
  \t\t\t\t\t\t\ttransition_errors << \"Los datos del solicitante #{x}, no fueron encontrados, por favor verifique.\"\r\n\
  \t\t\t\t\t\t\telse\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.tipo_documento\",tipo_documento)\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.cedula_pasaporte\",data[\"cedula\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.primer_nombre\",data[\"primerNombre\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.segundo_nombre\",data[\"segundoNombre\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.primer_apellido\",data[\"primerApellido\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.segundo_apellido\",data[\"segundoApellido\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.apellido_de_casada\",data[\"apellidoCasada\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_de_ubicacion.numero_de_telefono\",data[\"tlfLocal\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_de_ubicacion.correo_electronico\",data[\"email\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_de_ubicacion.pais\",data[\"pais\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_de_ubicacion.direccion\",data[\"direccionNacimiento\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_padre_instance_#{x}.datos_de_la_persona.documento_hijo\",data[\"cedula\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_padre_instance_#{x}.datos_de_la_persona.primer_nombre\",data[\"primerNombrePadre\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_padre_instance_#{x}.datos_de_la_persona.primer_apellido\",data[\"apellidoPaternoPadre\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_de_la_madre_instance_#{x}.datos_de_la_persona.documento_hijo\",data[\"cedula\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_de_la_madre_instance_#{x}.datos_de_la_persona.primer_nombre\",data[\"primerNombreMadre\"])\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_de_la_madre_instance_#{x}.datos_de_la_persona.primer_apellido\",data[\"apellidoPaternoMadre\"])\r\n\
  \t\t\t\t\t\t\t\r\n\
  \t\t\t\t\t\t\t\tfecha = data[\"fechaNacimiento\"]\r\n\
  \t\t\t\t\t\t\t\tfecha_n = Time.parse(fecha).strftime(\"%d-%m-%Y\")\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.fecha_de_nacimiento\",fecha_n)\r\n\
  \r\n\
  \t\t\t\t\t\t\t\tedad = ((Date.today - fecha.to_date).to_f / 365).to_i\r\n\
  \t\t\t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.edad\",edad)\r\n\
  \t\t\t\t\t\tend\r\n\
  \t\t\t\t\t\t \r\n\
  \t\t\t\t\telse\r\n\
  \t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.cedula_pasaporte\",nro_documento)\r\n\
  \t\t\t\t\t\tform_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.tipo_documento\",tipo_documento)\r\n\
  \t\t\t\t\t\tform_data.set(\"datos_del_padre_instance_#{x}.datos_de_la_persona.documento_hijo\",nro_documento)\r\n\
  \t\t\t\t\t\tform_data.set(\"datos_de_la_madre_instance_#{x}.datos_de_la_persona.documento_hijo\",nro_documento)\r\n\
  \t\t\t\t\t\t\t\t\r\n\
  \t\t\t\tend\r\n\
  \t\tend\t\t\t\r\n\
  \tend\r\n\
  \t\t\t\t\r\n\
  end"
views: 
back_step: ""
next_step: Paso 2 - Datos del Solicitante
position: 1
ajax_calls: ""
