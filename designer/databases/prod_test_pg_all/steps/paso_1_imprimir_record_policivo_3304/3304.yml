--- 
id: 3304
name: Paso 1- Imprimir Record Policivo
label: <strong style="color:#900C3F"> Firma de Record Policivo </strong>
description: |-
  <br><strong style="color:#FF5733">
  Por favor revise los datos del Record Policivo y posterior proceda a realizar las firmas correspondientes. </strong>
  <br/>
fill_step_id: 1777
created_at: 2017-01-27 19:31:48.430004 Z
updated_at: 2017-02-22 22:58:58.331261 Z
include: "{\"5152\":{\"3212\":{\"3629\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"3630\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}}},\"5153\":{\"3208\":{\"3716\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1973\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1469\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1470\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1471\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1472\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1473\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1474\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1475\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1479\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1477\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}},\"3209\":{\"805\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"585\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"594\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}},\"3267\":{\"528\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"529\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"530\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"537\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}},\"3268\":{\"528\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"529\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"530\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"537\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}},\"3269\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}},\"3294\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}},\"3271\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}},\"3272\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}},\"3273\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}}},\"5158\":{\"1710\":{\"1401\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1402\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}}},\"5185\":{\"3366\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}},\"3486\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}},\"3362\":{\"210\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"3485\":{\"210\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"5160\":{\"1710\":{\"1401\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,close,close_and_save,save,submit
on_becoming: "# SE SETEA EL CAMPO usuario2 CON EL MISMO NOMBRE DEL FUNCIONARIO YA QUE SE IMPRIME 2 VECES EN UNA MISMA P\xC3\x81GINA DEL PDF \r\n\
  #director= form_data.get(\"director_dij.datos_del_funcionario_generico.usuario\")\r\n\
  #form_data.set(\"director_dij.datos_del_funcionario_generico.usuario2\", director)\r\n\
  \r\n\
  # Inicializacion de datos del agente ### AGREGADO CAMBIO DE RUTAS DE FUNCIONARIO 17/10/2014\r\n\
  \r\n\
  _idagente = @task[\"agent_id\"].to_s\r\n\
  result = WebserviceConsumer.get( '/preconfigured_services/get_user_info.xml?agent_id=' + \"#{_idagente}\" + '&include_all=true').parsed_response\r\n\
  _hash = result[\"hash\"]\r\n\
  _agente = _hash[\"response\"]\r\n\
  \r\n\
  form_data.set(\"director_dij.datos_del_funcionario_generico.usuario\", _agente[\"name\"])\r\n\
  form_data.set(\"director_dij.datos_del_funcionario_generico.usuario2\", _agente[\"name\"])\r\n\
  \r\n\
  \r\n\
  # OBTENER PROVINCIA DE REVISION DE LA SOLICITUD EN ATTACHMENT#\r\n\
  #_app_id = @application[\"id\"]\r\n\
  #result = WebserviceConsumer.get('/service/dij_helper/call.json?method=provincia_print_design&app_id=' + \"#{_app_id}\").parsed_response\r\n\
  #provincia = result[\"response\"][\"provincia\"]\r\n\
  #form_data.set(\"datos_del_solicitante.datos_de_ubicacion.provincia\", provincia)\r\n\
  \r\n\
  #::: DV: AGREGADO 21/01/2016 :::#\r\n\
  #:::: SI EL TITULAR NO EXISTE EN LA DIJ Y NO ES EL owner, obtiene el nombre si el mismo viene vacio :::::#\r\n\
  if form_data.get(\"aprobacion_de_ciudadano.datos_del_funcionario_generico.usuario\").blank?\r\n\
  \tprimerNombret = form_data.get(\"datos_del_titular_rp.datos_basicos_de_persona_natural.primer_nombre\")\r\n\
  \tsegundoNombret = form_data.get(\"datos_del_titular_rp.datos_basicos_de_persona_natural.segundo_nombre\")\r\n\
  \tprimerApellidot = form_data.get(\"datos_del_titular_rp.datos_basicos_de_persona_natural.primer_apellido\")\r\n\
  \tsegundoApellidot = form_data.get(\"datos_del_titular_rp.datos_basicos_de_persona_natural.segundo_apellido\")\r\n\
  \tapellidoCasadat = form_data.get(\"datos_del_titular_rp.datos_basicos_de_persona_natural.apellido_de_casada\")\r\n\
  \tnombreCompletot = \"#{primerNombret} #{segundoNombret} #{primerApellidot} #{segundoApellidot} #{apellidoCasadat}\"\r\n\
  \tform_data.set(\"datos_del_titular_rp.datos_basicos_de_persona_natural.nombre_completo\",nombreCompletot.squish)\r\n\
  end"
on_transition: "## VALIDAR QUE EL ANEXO FIRMADO, SE ADJUNTE ##::: COMENTADO 22/07/2015 NO SE DEBE OBLIGAR A ADJUNTAR RECORD\r\n\
  #anexo = form_data.get(\"anexos_solicitud_de_record_policivo_funcionarios.record_policivo_firmado_por_el_director_y_o_secretaria.anexo\")\r\n\
  #if (anexo.blank?) \r\n  \t#transition_errors << \"Debe adjuntar el Record Policivo firmado. Por favor, verifique. \"\r\n\
  #end\r\n\
  \r\n\
  #_obs = form_data.get(\"director_dij.datos_del_funcionario_generico.observaciones\")\r\n\
  #_aprob = form_data.get(\"director_dij.datos_del_funcionario_generico.aprobacion\")\r\n\
  #if (_aprob ==\"NO\" and _obs.blank?) \r\n  # transition_errors << \"Debe indicar el motivo de su desaprobaci\xC3\xB3n en el campo (Observaci\xC3\xB3n). \"\r\n\
  #end\r\n\
  \r\n\
  \r\n\
  ######Usado para mostrar o no la tabla de sentencias en el Print designer#############\r\n\
  \r\n\
  \t#data= form_data.get(\"mensaje_dij.mensaje_dij.campo_data\")\r\n\
  \t#sin_sentencia = data.blank? ? \"Si\" : \" \"\r\n        #form_data.set(\"mensaje_dij.mensaje_dij.imprimir_sin_sentencia\",sin_sentencia)\r\n\
  \r\n\
  \r\n\
  ########Generar c\xC3\xB3digo unico y datos para impresi\xC3\xB3n##############\r\n\
  \r\n\
  codigo= form_data.get(\"codigo_unico_dij.codigo_unico_dij.dia\")\r\n\
  \r\n\
  #if codigo.blank?\r\n\
  \t#############Generar fecha para impresion###########\r\n\
  \tform_data.set(\"informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud\",@application[\"created_at\"])\r\n \r\n\
  \tanno = Time.now.year\r\n\
  \tmes= I18n.t(\"views.calendar.#{Time.now.strftime(\"%B\").downcase}\")\r\n\
  \tdia = Time.now.day\r\n\
  \r\n\
  \tform_data.set(\"codigo_unico_dij.codigo_unico_dij.year\",anno)\r\n\
  \tform_data.set(\"codigo_unico_dij.codigo_unico_dij.mes\",mes)\r\n\
  \tform_data.set(\"codigo_unico_dij.codigo_unico_dij.dia\",dia)\r\n\
  \r\n\
  \t##############Consecutivo######################\r\n\
  \r\n\
  \t#codf1= form_data.get(\"codigo_unico_dij.codigo_unico_dij.consecutivo\")\r\n\
  \t#result = WebserviceConsumer.get( '/consecutive/generador_dij_f2/generate.json').parsed_response\r\n\
  \t#_consecutivo = result[\"response\"]\r\n\
  \t#_consecutivo = \"#{codf1}-\"+\"#{_consecutivo[\"value\"]}\"\r\n\
  \t#form_data.set(\"informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud\",_consecutivo)\r\n\
  \r\n\
  \t#####c\xC3\xB3digo \xC3\xBAnico######################\r\n        #codigo_unico= form_data.get(\"datos_del_titular_rp.codigo_unico_dij.codigo_unico\")\r\n        #form_data.set(\"codigo_unico_dij.codigo_unico_dij.codigo_unico\",codigo_unico)\r\n\
  #end\r\n\
  \r\n\
  \r\n\
  ### DV: director PDF AGREGADO 17/10/2014\r\n\
  #_director = form_data.get(\"director_dij.datos_del_funcionario_generico.usuario\")\r\n\
  #form_data.set(\"director_dij.datos_del_funcionario_generico.usuario2\", _director)\r\n\
  \r\n\
  # OBTENER PROVINCIA DE REVISION DE LA SOLICITUD EN ATTACHMENT#\r\n\
  #_app_id = @application[\"id\"]\r\n\
  #result = WebserviceConsumer.get('/service/dij_helper/call.json?method=provincia_print_design&app_id=' + \"#{_app_id}\").parsed_response\r\n\
  #provincia = result[\"response\"][\"provincia\"]\r\n\
  #form_data.set(\"datos_del_solicitante.datos_de_ubicacion.provincia\", provincia)"
views: 
back_step: ""
next_step: ""
position: 1
ajax_calls: "//::: DV: Cambiar nombre secci\xC3\xB3n y color  paso 1::://\r\n\
  $(document).ready(function(){ \r\n   $( function() {\r\n    $(\"span\").each (function(){\r\n      if ($(this).html().trim() == \"Secci\xC3\xB3n: Tipo de Solicitud\") {  \r\n        $(this).html(\"Tipo de Solicitud\"); \r\n      }\r\n    });\r\n  });\r\n\
  \r\n  $( function() {\r\n    $(\"span\").each (function(){\r\n      if ($(this).html().trim() == \"Secci\xC3\xB3n: Datos del Solicitante\") {  \r\n        $(this).html(\"Gesti\xC3\xB3n de Solicitud\"); \r\n      }\r\n    });\r\n  });\r\n\
  \r\n  $( function() {\r\n    $(\"span\").each (function(){\r\n      if ($(this).html().trim() == \"Secci\xC3\xB3n: Datos del Titular\") {  \r\n        $(this).html(\"Informaci\xC3\xB3n del Titular\"); \r\n      }\r\n    });\r\n  });\r\n\
  \r\n  $( function() {\r\n    $(\"span\").each (function(){\r\n      if ($(this).html().trim() == \"Secci\xC3\xB3n: Recepci\xC3\xB3n Ventanilla \xC3\x9Anica\") {  \r\n        $(this).html(\"Recepci\xC3\xB3n de Ventanilla \xC3\x9Anica\"); \r\n      }\r\n    });\r\n  });\r\n\
  });\r\n\
  \r\n\
  $(document).ready(function(){ \r\n  TiDoc = $('#field_datos_del_titular_rp_datos_basicos_de_persona_natural_tipo_de_documento');\r\n  nacio = $('#field_datos_del_titular_rp_datos_basicos_de_persona_natural_nacionalidad');\r\n  if ($(TiDoc).html() == \"Cedula\") {\r\n    $(nacio).html(\"Nacional\");\r\n  } else if($(TiDoc).html() == \"Pasaporte\") {\r\n    $(nacio).html(\"Extranjero\");\r\n  }\r\n\
  });"
