--- 
id: 3093
name: Paso 1 - Datos del Arrendador
label: Datos del Arrendador
description: "Por favor complete la informaci\xC3\xB3n del Arrendador."
fill_step_id: 1654
created_at: 2015-01-13 15:39:10 Z
updated_at: 2015-01-16 20:05:19 Z
include: "{\"4745\":{\"580\":{\"1323\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"528\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"529\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"530\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"537\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"926\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"581\":{\"594\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"4746\":{\"595\":{\"567\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1282\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"568\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"598\":{\"1323\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"528\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"529\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"530\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"537\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"926\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"597\":{\"594\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"4747\":{\"1765\":{\"1613\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"2067\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3344\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4756\":{\"1710\":{\"1401\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"disabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,close,close_and_save,save
on_becoming: |-
  # Inicializacion de datos generales
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud",@application["created_at"])
  result = WebserviceConsumer.get( '/consecutive/generador_devolucion_depositos/generate.json').parsed_response
  _consecutivo = result["response"]
  _consecutivo = "#{@application["id"]}-"+"#{_consecutivo["value"]}"
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud",_consecutivo)
  
  #Datos del solicitante
  if @owner["kind_of_user_type"] == "NaturalPerson"
    form_data.set("informacion_de_arrendador_persona_natural.datos_de_la_persona.cedula",@owner["national_id"])
    form_data.set("informacion_de_arrendador_persona_natural.datos_de_la_persona.primer_nombre",@owner["first_name"]) 
    form_data.set("informacion_de_arrendador_persona_natural.datos_de_la_persona.segundo_nombre",@owner["second_name"])
    form_data.set("informacion_de_arrendador_persona_natural.datos_de_la_persona.primer_apellido",@owner["last_name"])
    form_data.set("informacion_de_arrendador_persona_natural.datos_de_la_persona.segundo_apellido",@owner["second_last_name"])
    form_data.set("informacion_de_arrendador_persona_natural.datos_de_la_persona.apellido_de_casada",@owner["married_name"])
    form_data.set("informacion_de_arrendador_persona_natural.informacion_de_residencia_localizacion.correo_electronico",@owner["email"])
  end
  if @owner["kind_of_user_type"] == "JuridicalPerson"
  
   form_data.set("informacion_de_arrendador_persona_juridica.datos_de_la_empresa.ruc",@owner["tax_id"])
   form_data.set("informacion_de_arrendador_persona_juridica.datos_de_la_empresa.nombre_comercial",@owner["name"])
   form_data.set("informacion_de_arrendador_persona_juridica.datos_de_la_empresa.correo_electronico",@owner["email"])	
    #result = WebserviceConsumer.get( '/service/bdin_mef_obtener_digito_verificador/find.json?rucg=' + "#{@owner["tax_id"]}").parsed_response
    #data = result["response"]
    #form_data.set("informacion_de_arrendador_persona_juridica.datos_de_la_empresa.digito_verficador",data["digitoVerificador"])
  end
on_transition: |-
  #Datos  el arrendatario
  tipoPersona = form_data.get("tipo_de_persona_del_arrendamiento.tipo_de_persona_del_arrendamiento.tipo")
  numDoc= form_data.get("tipo_de_persona_del_arrendamiento.tipo_de_persona_del_arrendamiento.numero_de_documento")
  
  if (tipoPersona=="Natural") 
  	
  	result = WebserviceConsumer.get( '/service/bdin_tribunal_electoral/find.json?cedula=' + "#{numDoc}").parsed_response
  	
  	if(!numDoc.blank?)
  		
  		data = result["response"]    
  		
  		if (!data.blank?) 
  			
  			form_data.set("informacion_del_arrendatario_natural.datos_de_la_persona.cedula",data["cedula"])
  			form_data.set("informacion_del_arrendatario_natural.datos_de_la_persona.primer_nombre",data["primerNombre"])
  			form_data.set("informacion_del_arrendatario_natural.datos_de_la_persona.segundo_nombre",data["segundoNombre"])
  			form_data.set("informacion_del_arrendatario_natural.datos_de_la_persona.primer_apellido",data["primerApellido"])
  			form_data.set("informacion_del_arrendatario_natural.datos_de_la_persona.segundo_apellido",data["segundoApellido"])
  			#form_data.set("informacion_del_arrendatario_natural.datos_de_la_persona.apellido_de_casada",data["married_name"])
  			#form_data.set("informacion_del_arrendatario_natural.informacion_de_residencia_localizacion.correo_electronico",data["email"])
  		else
  			transition_errors << "Los datos del arrendatario no fueron encontrados, por favor verifique."
  		end	 
  	end
  else
  	
  	if (tipoPersona=="Juridica")  
  		
  		tipoSoc=form_data.get("tipo_de_persona_del_arrendamiento.tipo_de_persona_del_arrendamiento.tipo_sociedad")
  		result = WebserviceConsumer.get(URI.escape('/service/bdin_registro_publico_ruc/find.json?ruc=' + "#{numDoc}" + '&tipo_sociedad=' + "#{tipoSoc}")).parsed_response
  		data = result["response"]
  		
  		if(!data.blank?)
  
  			form_data.set("informacion_del_arrendatario_juridico.datos_de_la_empresa.ruc",numDoc)	
  			form_data.set("informacion_del_arrendatario_juridico.datos_de_la_empresa.nombre",data["nombre_empresa"])   
  			#form_data.set("informacion_de_arrendador_persona_juridica.direccion.correo_electronico",data1["email"])	
  			#result = WebserviceConsumer.get( '/service/bdin_mef_obtener_digito_verificador/find.json?ruc=' + "#{numDoc}").parsed_response
  			#data2 = result["response"]
  			#if !data2.blank?
  				#form_data.set("informacion_del_arrendatario_juridico.datos_de_la_empresa.digito_verficador",data2["digitoVerificador"])	         
  			#else
  				#transition_errors << "El digito verificador no fue encontrado, por favor verifique: #{numDoc}"
  			#end
  		else  
  			transition_errors << "Los datos del arrendador no fueron encontrados, por favor verifique: #{numDoc}"
  		end
   	end
  end
views: 
back_step: ""
next_step: Paso 2 -  Datos de Arrendatario
position: 0
ajax_calls: "\t$( function() {\r\n    $( \"input:radio\" ).click(function() {\r\n\
  \t\t\tcheck(this);\r\n\
  \t\t});\r\n\
  \t\t\t\t\r\n\
  } );\r\n\
  \r\n\
  function check(obj) {\r\n\
  \t\tif (obj.value == \"Juridica\" && obj.name==\"[field][tipo_de_persona_del_arrendamiento_tipo_de_persona_del_arrendamiento_tipo]\"){\r\n\
  \t\t\t\t\t   \t$(\"#field_tipo_de_persona_del_arrendamiento_tipo_de_persona_del_arrendamiento_tipo_sociedad\").removeAttr(\"disabled\");\t\r\n\
  \t\t\t\t\t\t$(\"#field_tipo_de_persona_del_arrendamiento_tipo_de_persona_del_arrendamiento_tipo_sociedad option[value='SA']\").removeAttr(\"disabled\");\r\n\
  \t\t\t\t\t\t$(\"#field_tipo_de_persona_del_arrendamiento_tipo_de_persona_del_arrendamiento_tipo_sociedad option[value='EX']\").removeAttr(\"disabled\");\r\n\
  \t\t\t\t\t\t$(\"#field_tipo_de_persona_del_arrendamiento_tipo_de_persona_del_arrendamiento_tipo_sociedad option[value='FU']\").removeAttr(\"disabled\");\r\n\
  \t\t\t\t\t\t$(\"#field_tipo_de_persona_del_arrendamiento_tipo_de_persona_del_arrendamiento_tipo_sociedad option[value='LI']\").removeAttr(\"disabled\");\r\n\
  \t\t\t\t\t\t\t}else{\r\n\
  \t\t\t\t\t\t\t$(\"#field_tipo_de_persona_del_arrendamiento_tipo_de_persona_del_arrendamiento_tipo_sociedad\").attr(\"disabled\",\"disabled\");\r\n\
  \t\t\t\t\t\t\t}\r\n\
  \t\t\t\t\t\t}\r\n"
