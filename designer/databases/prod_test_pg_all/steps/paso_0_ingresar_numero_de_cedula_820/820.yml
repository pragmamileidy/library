--- 
id: 820
name: "Paso 0 - Ingresar n\xC3\xBAmero de Cedula"
label: "Ingresar n\xC3\xBAmero de C\xC3\xA9dula para el Subsidio"
description: ""
fill_step_id: 207
created_at: 2012-08-13 15:19:06 Z
updated_at: 2015-10-19 02:44:28 Z
include: "{\"1013\":{\"580\":{\"1323\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"1017\":{\"1710\":{\"1401\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,close,close_and_save,save
on_becoming: "# Inicializacion de datos generales\r\n\
  form_data.set(\"informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud\",@application[\"created_at\"])\r\n\
  result = WebserviceConsumer.get( '/consecutive/generador_css_SBENF/generate.json').parsed_response\r\n\
  _consecutivo = result[\"response\"]\r\n\
  _consecutivo = \"#{@application[\"id\"]}-\"+\"#{_consecutivo[\"value\"]}\"\r\n\
  form_data.set(\"informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud\",_consecutivo)\r\n\
  \r\n\
  \r\n\
  person = @application[\"person_id\"]\r\n\
  owner = @application[\"owner_person_id\"]\r\n\
  \r\n\
  if person != owner\r\n    if @owner[\"natural_person_type\"]==\"national_citizen\"\r\n        _tipo = \"C\xC3\xA9dula\"\r\n        _ci = @owner[\"national_id\"]\r\n        result = WebserviceConsumer.get('/service/bdin_tribunal_electoral/find.json?cedula=' + \"#{_ci}\").parsed_response\r\n        datos = result[\"response\"]\r\n        if !datos.nil?\r\n            form_data.set(\"beneficiaria_del_subsidio.representado_por.cedula_pasaporte\",datos[\"cedula\"])\r\n            form_data.set(\"beneficiaria_del_subsidio.representado_por.nombre_completo\",datos[\"primerNombre\"]+\" \"+datos[\"segundoNombre\"]+\" \"+datos[\"primerApellido\"]+\" \"+datos[\"segundoApellido\"])\r\n            form_data.set(\"beneficiaria_del_subsidio.representado_por.numero_de_telefono\", @owner[\"fixed_number\"])\r\n            form_data.set(\"beneficiaria_del_subsidio.representado_por.email\", datos[\"email\"])\r\n        end     \r\n\
  \r\n    else\r\n        if ((@owner[\"kind_of_user_type\"] == \"NaturalPerson\") && (@owner[\"natural_person_type\"] == \"foreign_citizen\"))\r\n            form_data.set(\"beneficiaria_del_subsidio.representado_por.cedula_pasaporte\", @owner[\"passport\"])\r\n            form_data.set(\"beneficiaria_del_subsidio.representado_por.nombre_completo\", @owner[\"first_name\"]+\" \"+@owner[\"second_name\"]+\" \"+@owner[\"last_name\"]+\" \"+@owner[\"second_last_name\"])\r\n            form_data.set(\"beneficiaria_del_subsidio.representado_por.numero_de_telefono\", @owner[\"fixed_number\"])\r\n            form_data.set(\"beneficiaria_del_subsidio.representado_por.email\", @owner[\"email\"])\r\n        end\r\n    end\r\n\
  \r\n\
  \r\n\
  end   \r\n\
  \r\n ###Se setean datos del solicitante###\r\n    if person == owner\r\n        _idpersona = @application[\"person_id\"].to_s\r\n        result = WebserviceConsumer.get( '/preconfigured_services/get_user_info.xml?person_id=' + \"#{_idpersona}\" + '&include_all=true').parsed_response\r\n        _hash = result[\"hash\"]\r\n        persona = _hash[\"response\"]\r\n        form_data.set(\"datos_del_solicitante.datos_persona_natural.cedula\",persona[\"person_gov_id_number\"])\r\n        form_data.set(\"datos_del_solicitante.datos_persona_natural.nombre_completo\",persona[\"name\"])\r\n        form_data.set(\"datos_del_solicitante.datos_persona_natural.email\",persona[\"email\"])\r\n        #form_data.set(\"datos_del_solicitante.datos_persona_natural.numero_de_telefono\",persona[\"fixed_number\"])\r\n    end "
on_transition: "#VERIFICACI\xC3\x92N NUMERO DE CEDULA DEL SOLICITANTE LEGAL NO PERTENEZCA A UN DIFUNTO\r\n\
  person = @application[\"person_id\"]\r\n\
  owner = @application[\"owner_person_id\"]\r\n\
  \r\n\
  if person == owner\r\n    numdoc = form_data.get(\"datos_del_solicitante.datos_persona_natural.cedula\")\r\n    resultado = WebserviceConsumer.get(URI.escape('/service/bdin_tribunal_electoral/find.json?cedula=' + \"#{numdoc}\")).parsed_response\r\n    datosSol = resultado[\"response\"]\r\n    if datosSol.blank? \r\n        transition_errors << \"La C\xC3\xA9dula del Solicitante no fue encontrada. Por favor, verifique.\" \r\n    else            \r\n        difunto = datosSol[\"mensaje\"]\r\n        if (difunto != \"ND\")\r\n            transition_errors << \"No puede continuar con el tr\xC3\xA1mite, ya que la c\xC3\xA9dula nro. #{numdoc} del Solicitante corresponde a un ciudadano Difunto.\"\r\n        end\r\n    end\r\n\
  end\r\n\
  \r\n\
  \r\n\
  \r\n\
  \r\n\
  ### VLIDACII\xC3\x93N DE NUMERO DE DOCUMENTO DEL Representante NO PERTENEZCA A UN DIFUNTO\r\n\
  if person != owner\r\n\
  if ((@owner[\"kind_of_user_type\"] == \"NaturalPerson\") && (@owner[\"natural_person_type\"] == \"national_citizen\"))\r\n        ced = form_data.get(\"beneficiaria_del_subsidio.representado_por.cedula_pasaporte\")\r\n        result = WebserviceConsumer.get(URI.escape('/service/bdin_tribunal_electoral/find.json?cedula=' + \"#{ced}\")).parsed_response\r\n        datos = result[\"response\"]\r\n        if datos.blank? \r\n                transition_errors << \"La C\xC3\xA9dula nro.  #{ced} no fue encontrada. Por favor, verifique.\" \r\n        else\r\n                difunto = datos[\"mensaje\"]\r\n                if (difunto != \"ND\")\r\n                        transition_errors << \"No puede continuar con el tr\xC3\xA1mite, ya que la C\xC3\xA9dula nro. #{ced} del Representante, corresponde a un ciudadano Difunto.\"\r\n                end\r\n        end\r\n\
  end\r\n\
  end\r\n\
  \r\n\
  _cedula = form_data.get(\"beneficiaria_del_subsidio.datos_de_la_persona.cedula\")\r\n \r\n\
  #Obtener datos del subsidiado\r\n\
  result = WebserviceConsumer.get('/service/bdin_tribunal_electoral/find.json?cedula=' +  \"#{_cedula}\").parsed_response\r\n\
  _asegurada = result[\"response\"]\r\n\
  if !_asegurada.nil?\r\n        difun = _asegurada[\"mensaje\"]\r\n        if (difun != \"ND\")\r\n            transition_errors << \"No puede continuar con el tr\xC3\xA1mite, ya que la c\xC3\xA9dula nro. #{_cedula} de la beneficiaria, corresponde a un ciudadano Difunto.\"\r\n        end\r\n        form_data.set(\"beneficiaria_del_subsidio.datos_de_la_persona.cedula\",_asegurada[\"cedula\"])\r\n        form_data.set(\"beneficiaria_del_subsidio.datos_de_la_persona.primer_nombre\",_asegurada[\"primerNombre\"])\r\n        form_data.set(\"beneficiaria_del_subsidio.datos_de_la_persona.segundo_nombre\",_asegurada[\"segundoNombre\"])\r\n        form_data.set(\"beneficiaria_del_subsidio.datos_de_la_persona.primer_apellido\",_asegurada[\"primerApellido\"])\r\n        form_data.set(\"beneficiaria_del_subsidio.datos_de_la_persona.segundo_apellido\",_asegurada[\"segundoApellido\"])\r\n        form_data.set(\"beneficiaria_del_subsidio.datos_de_la_persona.apellido_de_casada\",_asegurada[\"apellidoCasada\"])\r\n\
  \r\n\
  else\r\n    transition_errors << \"El n\xC3\xBAmero de c\xC3\xA9dula suministrada no existe en el sistema. Por favor revise el valor.\"\r\n\
  end"
views: 
back_step: ""
next_step: Paso 1 - Informacion de la Solicitud
position: 0
ajax_calls: ""
