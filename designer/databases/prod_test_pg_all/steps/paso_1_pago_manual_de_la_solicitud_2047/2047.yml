--- 
id: 2047
name: Paso 1 - Pago Manual de la Solicitud
label: Pago Manual de la Solicitud
description: Pago Manual de la Solicitud
fill_step_id: 1058
created_at: 2013-06-28 12:55:08 Z
updated_at: 2014-03-10 19:14:37 Z
include: "{\"3945\":{\"2839\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2840\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2841\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2842\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2843\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2844\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2845\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2846\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2847\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2848\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2849\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2850\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2851\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2852\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2853\":{\"3101\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2849\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2854\":{\"2892\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"2469\":{\"2054\":{\"2164\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2165\":{\"views\":\"default\",\"enabled\":\"disabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,close,close_and_save,save
on_becoming: |-
  #CODIGO PARA INVOCAR EL SERVICIO payment_computing_service
   _applicationId = @application["id"]
   _configRoute = "Rates-rates"
   _formId = @task["form"]
  _taskId = @task["id"]
  
  # ***** Servicio nuevo *****
    hash = {:application_id => "#{_applicationId}", 
                :config_route   => "#{_configRoute}",
                :form_id          => "#{_formId}",
                :task_id          => "#{_taskId}"}
    result = PaymentProxy.manual_computing_service(hash)
  
  
  _payment_id= result["response"]["payment_id"]
  _detail = result["response"]["detail"]
  _total = result["response"]["result"]["total"]
  
  form_data.set("variables_pago_generico.variables_pago_generico.payment",_payment_id)
  form_data.set("variables_pago_generico.variables_pago_generico.detail",_detail)
  form_data.set("datos_del_evaluador_generico.monto_total.monto_total", _total)
  
  result["response"]["result"]["items"].each do |key, value|
   if(key =~ /item_instance_([\d]+)/)
    _i = $1.to_i - 1
      form_data.set("datos_del_evaluador_generico.entidad_evaluadora_#{_i}.nombre_de_la_entidad", value["name"])
      form_data.set("datos_del_evaluador_generico.entidad_evaluadora_#{_i}.pagada", "Iniciada")
      form_data.set("datos_del_evaluador_generico.entidad_evaluadora_#{_i}.monto_a_pagar", value["formula"])
   end 
  end
on_transition: ""
views: 
back_step: ""
next_step: Paso 2 - Ingresar Pago de la Solicitud
position: 0
ajax_calls: |
  $( function() {
  	
  	$(document).ready(function(){
  
  		function partContainer(obj) { 
  			return obj.parent().parent().parent().parent().parent().children(); 
  		};
  		function valueIsCero(obj) { 
  			return ((obj.val() == "") || (obj.val() == 0)); 
  		};
  		function hideIfCero(obj) { 
  			if( valueIsCero(obj) ){ partContainer(obj).hide(); partContainer(obj).parent().hide(); };
  		};
  
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_0_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_1_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_2_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_3_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_4_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_5_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_6_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_7_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_8_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_9_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_10_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_11_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_12_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_13_monto_a_pagar'));
  		hideIfCero($('#field_datos_del_evaluador_generico_entidad_evaluadora_14_monto_a_pagar'));
  
  
  	});
  });

