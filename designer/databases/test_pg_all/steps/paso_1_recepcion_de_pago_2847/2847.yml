--- 
id: 2847
name: Paso 1 - Recepcion de Pago
label: "Recepci\xC3\xB3n de Pago"
description: "Recepci\xC3\xB3n de Pago"
fill_step_id: 1533
created_at: 2014-04-09 16:29:12 Z
updated_at: 2014-04-09 16:29:12 Z
include: "{\"3633\":{\"1824\":{\"1366\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1367\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1368\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1369\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1371\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2544\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4029\":{\"2054\":{\"2164\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2165\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"2168\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"4030\":{\"2054\":{\"2164\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2165\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3447\":{\"views\":\"default\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,close,close_and_save,save,submit
on_becoming: |-
  # Inicializacion de datos del agente - LG
  
  _idagente = @task["agent_id"].to_s
  
  result = WebserviceConsumer.get( '/preconfigured_services/get_user_info.xml?agent_id=' + "#{_idagente}" + '&include_all=true').parsed_response
  _hash = result["hash"]
  _agente = _hash["response"]
  
  
  form_data.set("recibido_por_pago.datos_del_funcionario_proceso.usuario", _agente["name"])
  form_data.set("recibido_pago.datos_del_funcionario_proceso.usuario", _agente["name"])
on_transition: "##### RECEPCION DE PAGO #####\r\n\
  id_pago = form_data.get(\"variables_pago_generico.variables_pago_generico.payment\")\r\n\
  \r\n\
  respuesta_del_agente = form_data.get(\"recibido_por_pago.datos_del_funcionario_proceso.seleccione_el_resultado_de_su_evaluacion\")\r\n\
  if respuesta_del_agente.blank?\r\n  respuesta_del_agente = form_data.get(\"recibido_pago.datos_del_funcionario_proceso.seleccione_el_resultado_de_su_evaluacion_ok_rechazo\")\r\n\
  end\r\n\
  \r\n\
  _obs = form_data.get(\"recibido_por_pago.datos_del_funcionario_proceso.observaciones\")\r\n\
  if _obs.blank?\r\n\
  \t_obs = form_data.get(\"recibido_pago.datos_del_funcionario_proceso.observaciones\")\r\n\
  end\r\n\
  \r\n\
  _error = false\r\n\
  \r\n\
  if (respuesta_del_agente ==\"REPARO\" && _obs.blank?) \r\n\
  \t_error = true\r\n   transition_errors << \"Debe indicar el motivo del reparo en el campo (Observaci\xC3\xB3n). \"\r\n\
  end\r\n\
  \r\n\
  if (respuesta_del_agente ==\"RECHAZO\" && _obs.blank?)\r\n   _error = true\r\n   transition_errors << \"Debe indicar el motivo del rechazo en el campo (Observaci\xC3\xB3n). \"\r\n\
  end\r\n\
  \r\n\
  if !_error\r\n\
  \tPaymentProxy.payment_reception(id_pago, respuesta_del_agente)\r\n\
  end\r\n"
views: 
back_step: ""
next_step: ""
position: 1
ajax_calls: ""
