--- 
id: 1183
name: Paso 5 -  Particiantes de la Obra
label: Participantes de la Obra
description: ""
fill_step_id: 586
created_at: 2013-03-14 18:40:29 Z
updated_at: 2013-05-20 21:06:25 Z
include: "{\"2523\":{\"2634\":{\"3051\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"2974\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"2954\":{\"views\":\"default\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,back,next,close,close_and_save,save
on_becoming: ""
on_transition: "_encontradas = []\r\n\
  _no_en =[]\r\n\
  _duplicadas = []\r\n\
  (1..5).each do |_num|\r\n\
  \t_tipo = form_data.get(\"participantes_de_la_obra.participantes_instance_#{_num}.tipo_identificacion\")\r\n\
  \tform_data.set(\"participantes_de_la_obra.participantes_instance_#{_num}.tipo_de_documento\",_tipo)\r\n\
  \tif _tipo == \"Cedula\"\r\n\
  \t\tnro_documento = form_data.get(\"participantes_de_la_obra.participantes_instance_#{_num}.cedula_pasaporte\")\r\n\
  \t\tif !nro_documento.blank?\r\n\
  \t\t\tresult = WebserviceConsumer.get('/service/bdin_tribunal_electoral/find.json?cedula=' + \"#{nro_documento}\").parsed_response\r\n\
  \t\t\tdatos = result[\"response\"]\r\n\
  \t\t\tif datos.blank? \r\n\
  \t\t\t\t_no_en << nro_documento\r\n\
  \t\t\telse\r\n\
  \t\t\t\t_encontradas << nro_documento\r\n\
  \t\t\t\tform_data.set(\"participantes_de_la_obra.participantes_instance_#{_num}.cedula_pasaporte\",datos[\"cedula\"])\r\n\
  \t\t\t\t#Nombre Completo\r\n\
  \t\t\t\tnombre_completo= \"#{datos[\"primerNombre\"]} \"+\"#{datos[\"segundoNombre\"]} \"+\"#{datos[\"primerApellido\"]} \"+\"#{datos[\"segundoApellido\"]}  \"+\"#{datos[\"apellidoCasada\"]}\"\r\n\
  \t\t\t\tform_data.set(\"participantes_de_la_obra.participantes_instance_#{_num}.nombre\",nombre_completo)\t\t\t\r\n\
  \t\t\t\t#form_data.set(\"participantes_de_la_obra.participantes_instance_#{_num}.direccion\",datos[\"direccion\"])\r\n\
  \t\t\t\tdatos = nil\r\n\
  \t\t\tend\r\n\
  \t\tend\r\n\
  \tend\r\n\
  \tif _tipo == \"Pasaporte\"\r\n\
  \t\tnro_documento = form_data.get(\"participantes_de_la_obra.participantes_instance_#{_num}.cedula_pasaporte\")\r\n\
  \t\tform_data.set(\"participantes_de_la_obra.participantes_instance_#{_num}.cedula_pasaporte\",nro_documento)\r\n\
  \tend\r\n\
  \r\n\
  \tcategoria = form_data.get(\"participantes_de_la_obra.participantes_instance_#{_num}.tipo_de_participante1\")\r\n\
  \tform_data.set(\"participantes_de_la_obra.participantes_instance_#{_num}.categoria\",categoria)\r\n\
  end\r\n\
  \r\n\
  if !_no_en.blank?\r\n\
  \ttransition_errors << \"La(s) cedula(s) #{_no_en.join(\",\")} no se encuentran en el sistema\"\r\n\
  end\r\n\
  \r\n\
  if !_encontradas.blank?\r\n\
  \t_duplicadas = _encontradas.detect{|e| _encontradas.count(e) > 1}\r\n\
  \tif !_duplicadas.blank?\r\n\
  \t\ttransition_errors << \"Una de las cedulas se introdujo m\xC3\xA1s de una vez\"\r\n\
  \tend\r\n\
  end"
views: 
back_step: "Paso 4 - Datos del Productor "
next_step: Paso 6  - Datos del Participante (s) de la Obra
position: 5
ajax_calls: ""
