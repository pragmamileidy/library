--- 
id: 3293
name: Paso 1- Entrega de Record Policivo
label: <strong style="color:#900C3F"> Entrega de Record Policivo </strong>
description: |-
  <br><strong style="color:#FF5733">
  Entrega de Record Policivo </strong>
  <br/>
fill_step_id: 1769
created_at: 2017-01-05 14:18:28.072377 Z
updated_at: 2017-01-06 13:52:04.631033 Z
include: "{\"5166\":{\"3212\":{\"3629\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"3630\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}}},\"5163\":{\"3209\":{\"2456\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}}},\"5168\":{\"3208\":{\"3716\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1973\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1469\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1470\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1471\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1472\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1473\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1474\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1475\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1479\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1477\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}},\"3209\":{\"805\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"585\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"594\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}},\"3267\":{\"528\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"529\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"530\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"537\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}},\"3268\":{\"528\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"529\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"530\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"537\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}},\"3269\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}},\"3294\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}},\"3271\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}},\"3272\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}},\"3273\":{\"210\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}},\"3369\":{\"3639\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}}},\"5176\":{\"1710\":{\"1401\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}}},\"5179\":{\"1710\":{\"1401\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}}},\"5181\":{\"1710\":{\"1401\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"5182\":{\"3223\":{\"3633\":{\"views\":\"default\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,close,close_and_save,save,submit
on_becoming: |
  #::: OBTENER PROVINCIA DE REVISION DE LA SOLICITUD EN ATTACHMENT :::#
  _app_id = @application["id"]
  result = WebserviceConsumer.get('/service/dij_helper/call.json?method=provincia_print_design&app_id=' + "#{_app_id}").parsed_response
  provincia = result["response"]["provincia"]
  form_data.set("datos_del_solicitante.datos_de_ubicacion.provincia", provincia)
  
  #::: INICIALIZAR LOS DATOS DEL AGENTE :::#
  _idagente = @task["agent_id"].to_s
  result = WebserviceConsumer.get( '/preconfigured_services/get_user_info.xml?agent_id=' + "#{_idagente}" + '&include_all=true').parsed_response
  _hash = result["hash"]
  _agente = _hash["response"]
  form_data.set("confirmar_entrega_record.datos_del_funcionario_generico.usuario", _agente["name"])

on_transition: "#::: GENERAR C\xC3\x93DIGO UNICO Y DATOS PARA IMPRESI\xC3\x93N :::#\r\n\
  codigo = form_data.get(\"codigo_unico_dij.codigo_unico_dij.dia\")\r\n\
  \r\n\
  #::: GENERAR FECHA PARA IMPRESION :::#\r\n\
  form_data.set(\"informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud\",@application[\"created_at\"])\r\n\
  anno = Time.now.year\r\n\
  mes= I18n.t(\"views.calendar.#{Time.now.strftime(\"%B\").downcase}\")\r\n\
  dia = Time.now.day\r\n\
  \r\n\
  form_data.set(\"codigo_unico_dij.codigo_unico_dij.year\",anno)\r\n\
  form_data.set(\"codigo_unico_dij.codigo_unico_dij.mes\",mes)\r\n\
  form_data.set(\"codigo_unico_dij.codigo_unico_dij.dia\",dia)\r\n\
  \r\n\
  #::: PDF DIRECTOR AGREGADA 17/10/2014 :::#\r\n\
  director = form_data.get(\"director_dij.datos_del_funcionario_generico.usuario\")\r\n\
  form_data.set(\"director_dij.datos_del_funcionario_generico.usuario2\", director)\r\n\
  \r\n\
  #::: OBTENER PROVINCIA DE REVISION DE LA SOLICITUD EN ATTACHMENT :::#\r\n\
  _app_id = @application[\"id\"]\r\n\
  result = WebserviceConsumer.get('/service/dij_helper/call.json?method=provincia_print_design&app_id=' + \"#{_app_id}\").parsed_response\r\n\
  provincia = result[\"response\"][\"provincia\"]\r\n\
  form_data.set(\"datos_del_solicitante.datos_de_ubicacion.provincia\", provincia)\r\n\
  \r\n\
  # :::::::::::::::::::::::::::::: DV: VIEJA IMPLEMENTACION MEJORADO ::::::::::::::::::::::::::::::::::#\r\n\
  # \t#############Consecutivo######################\r\n\
  #\r\n\
  # \tcodf1= form_data.get(\"codigo_unico_dij.codigo_unico_dij.consecutivo\")\r\n\
  # \tresult = WebserviceConsumer.get( '/consecutive/generador_dij_f2/generate.json').parsed_response\r\n\
  # \t_consecutivo = result[\"response\"]\r\n\
  # \t_consecutivo = \"#{codf1}-\"+\"#{_consecutivo[\"value\"]}\"\r\n\
  # \tform_data.set(\"informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud\",_consecutivo)\r\n\
  #\r\n\
  # \t####c\xC3\xB3digo \xC3\xBAnico######################\r\n\
  #         codigo_unico= form_data.get(\"datos_del_titular_rp.codigo_unico_dij.codigo_unico\")\r\n\
  #         form_data.set(\"codigo_unico_dij.codigo_unico_dij.codigo_unico\",codigo_unico)\r\n\
  # end\r\n\
  # :::::::::::::::::::::::::::::: DV: VIEJA IMPLEMENTACION MEJORADO ::::::::::::::::::::::::::::::::::#"
views: 
back_step: ""
next_step: ""
position: 1
ajax_calls: "$(document).ready(function(){  \r\n  $( function() {\r\n    $(\"div\").each (function(){\r\n      if ($(this).html().trim() == \"Secci\xC3\xB3n: Datos del Solicitante\") {  \r\n        $(this).html(\"Gesti\xC3\xB3n de Solicitud\"); \r\n      }\r\n    });\r\n  });\r\n\
  \r\n  $( function() {\r\n    $(\"div\").each (function(){\r\n      if ($(this).html().trim() == \"Datos de Ubicaci\xC3\xB3n de la Persona\") {  \r\n        $(this).html(\"Oficina donde desea gestionar su Solicitud\"); \r\n      }\r\n    });\r\n  });\r\n\
  \r\n  $( function() {\r\n    $(\"div\").each (function(){\r\n      if ($(this).html().trim() == \"Secci\xC3\xB3n: Datos del Titular\") {  \r\n        $(this).html(\"Informaci\xC3\xB3n del Titular\"); \r\n      }\r\n    });\r\n  });\r\n\
  \r\n  TiDoc = $('#field_datos_del_titular_rp_datos_basicos_de_persona_natural_tipo_de_documento').html();\r\n  nacio = $('#field_datos_del_titular_rp_datos_basicos_de_persona_natural_nacionalidad').html();\r\n  if ($(TiDoc).html() == \"Cedula\") {\r\n    $(nacio).html(\"Nacional\");\r\n  } else if($(TiDoc).html() == \"Pasaporte\") {\r\n    $(nacio).html(\"Extranjero\");\r\n  }\r\n\
  });"
