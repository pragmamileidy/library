--- 
id: 1149
name: Paso 1 - Solicitud de datos del Autor (es) o Titular (es)
label: Solicitud de datos del Autor (es) o Titular (es)
description: ""
fill_step_id: 574
created_at: 2013-03-13 17:14:57 Z
updated_at: 2014-11-26 18:43:51 Z
include: "{\"4310\":{\"3143\":{\"3112\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3113\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3604\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"3144\":{\"3002\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"2482\":{\"1710\":{\"1401\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"disabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,close,close_and_save,save
on_becoming: |-
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud",@application["created_at"])
  result = WebserviceConsumer.get( '/consecutive/generador_musicalesObras/generate.json').parsed_response
  _consecutivo = result["response"]
  _consecutivo = "#{@application["id"]}-"+"#{_consecutivo["value"]}"
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud",_consecutivo)
on_transition: "##### MT - BUSQUEDA DE DATOS AUTORES\r\n\
  (1..5).each do |_num|\r\n tipo_doc = form_data.get(\"tipo_de_autor_instance_#{_num}.documento.tipo_de_documento\")\r\n tipoAut = form_data.get(\"tipo_de_autor_instance_#{_num}.tipo_de_autor.autor_de_la_musica\")\r\n nro_documento = form_data.get(\"tipo_de_autor_instance_#{_num}.documento.numero_documento\")\r\n form_data.set(\"datos_del_autor_instance_#{_num}.tipo_de_identificacion.tipo_identificacion_texto\", tipo_doc)\t\r\n\
  \tif tipo_doc != \"RUC\"\r\n\
  \t\t\tform_data.set(\"datos_del_autor_instance_#{_num}.tipo_de_autor.tipo\", tipoAut)\t\r\n\
  \t\t\tif tipo_doc == \"C\xC3\xA9dula\"\t\r\n\
  \t\t\t\tresult = WebserviceConsumer.get('/service/bdin_tribunal_electoral/find.json?cedula=' + \"#{nro_documento}\").parsed_response\r\n\
  \t\t\t\t_persona = result[\"response\"]\r\n\
  \t\t\t\tif !_persona.blank?\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_persona.cedula_pasaporte\",_persona[\"cedula\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_persona.primer_nombre\",_persona[\"primerNombre\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_persona.segundo_nombre\",_persona[\"segundoNombre\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_persona.primer_apellido\",_persona[\"primerApellido\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_persona.segundo_apellido\",_persona[\"segundoApellido\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_persona.nacionalidad\",_persona[\"lugarNacimiento\"])\r\n                    form_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_persona.fecha_de_nacimiento_string\",_persona[\"fechaNacimiento\"])\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_persona.direccion\",_persona[\"full_address\"])\r\n\
  \t\t\t\tend\r\n\
  \t\t\t\tif _persona.blank?\r\n\
  \t\t\t\t\ttransition_errors << \"La c\xC3\xA9dula suministrada no existe en el sistema, favor revise  el n\xC3\xBAmero especificado en el autor  \" + \"#{_num}\"\r\n\
  \t\t\t\tend\r\n\
  \t\t\tend\t\r\n\
  \t\t\tif tipo_doc == \"Pasaporte\"  \r\n\
  \t\t\t\tform_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_persona.cedula_pasaporte\",nro_documento)\r\n\
  \t\t\tend\t\r\n\
  \t\r\n\
  \tend\r\n\
  \tif tipo_doc == \"RUC\"\r\n\
  \t\ttipoSoc = form_data.get(\"tipo_de_autor_instance_#{_num}.documento.tipo_sociedad\") \t\r\n\
  \t\t\tif !nro_documento.blank?\r\n\
  \t\t\tresult = WebserviceConsumer.get(URI.escape('/service/bdin_registro_publico_ruc/find.json?ruc=' + \"#{nro_documento}\" + '&tipo_sociedad=' + \"#{tipoSoc}\")).parsed_response\r\n\
  \t\t\tdata = result[\"response\"]  \r\n\
  \t\t\t\tif !data.blank?\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_empresa.nombre_comercial\",data[\"nombre_empresa\"])\t\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_empresa.ruc\",nro_documento) \r\n                    form_data.set(\"datos_del_autor_instance_#{_num}.datos_de_la_empresa.tipo_sociedad\",tipoSoc) \r\n\
  \t\t\t\telse\r\n\
  \t\t\t\t\ttransition_errors << \"El ruc introducido no esta registrado en el sistema o tiene tipo de sociedad incorrecta, por favor verifique: #{nro_documento}\"\r\n\
  \t\t\t\tend\r\n\
  \t\t\tend\r\n\
  \t\tform_data.set(\"datos_del_autor_instance_#{_num}.tipo_de_autor.tipo\", tipoAut)\t\r\n\
  \tend\t                                \r\n\
  end\r\n"
views: 
back_step: ""
next_step: Paso 2 - Datos del Autor (es) o Titular (es)
position: 1
ajax_calls: "$.each( $('[id*=field_tipo_de_autor_instance_]'), function(index, campo) {\r\n\
  \tocultarcampos(this.value,this.id);\r\n\
  \tif ($(campo).attr('id').match(/_documento_tipo_de_documento/)) {\r\n\
  \t\t$(campo).attr('onchange', 'ocultarcampos(this.value,this.id);')\r\n\
  \t}\r\n\
  });\r\n\
  \r\n\
  function ocultarcampos(dato,idmarca) {\r\n\
  \tvar pos = (idmarca).match(/instance_[\\d][\\d]/);\r\n\
  \tif (pos == null){\r\n\
  \t\tpos = (idmarca).match(/instance_[\\d]/);\r\n\
  \t}\r\n\
  \r\n\
  \tvar tipo = \"#field_tipo_de_autor_\";\r\n\
  \tvar mod1 = tipo.concat(pos)\r\n\
  \tvar docs = \"_documento_tipo_de_documento\";\r\n\
  \tvar num = \"_documento_numero_documento\";\r\n\
  \tvar soc = \"_documento_tipo_sociedad\";\r\n\
  \tvar documento_d = mod1.concat(docs);\r\n\
  \tvar documento_num = mod1.concat(num);\r\n\
  \tvar documento_soc = mod1.concat(soc);\r\n\
  \tif($(documento_d).val() == \"\"){ \r\n\
  \t\t$(documento_soc).parent().parent().hide();\r\n\
  \t}\r\n\
  \telse if($(documento_d).val() == 'C\xC3\xA9dula' || $(documento_d).val() == 'Pasaporte'){ \r\n\
  \t\t$(documento_soc).val('');\r\n\
  \t\t$(documento_soc).parent().parent().hide();\r\n\
  \t}\r\n\
  \telse {\r\n\
  \t\t$(documento_soc).parent().parent().show();\r\n\
  \t}\t\t\t\r\n\
  }\r\n\
  \r\n"
