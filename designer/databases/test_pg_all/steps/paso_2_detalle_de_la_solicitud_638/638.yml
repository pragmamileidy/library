--- 
id: 638
name: Paso 2 -  Detalle de la solicitud
label: Detalle de la Solicitud
description: "Detalle de la solicitud de certificaci\xC3\xB3n de descuentos"
fill_step_id: 330
created_at: 2012-06-20 14:41:08 Z
updated_at: 2014-03-19 23:49:37 Z
include: "{\"2298\":{\"1725\":{\"1973\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1883\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"1726\":{\"585\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"631\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"1619\":{\"1995\":{\"2056\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"2057\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"2058\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"2021\":{\"2056\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"2057\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"2058\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"1620\":{\"2023\":{\"2062\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"2063\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"7\":{\"1949\":{\"2465\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"1885\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"1886\":{\"views\":\"default\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,back,next,close,close_and_save,save
on_becoming: ""
on_transition: "\r\n\
  \tci = form_data.get(\"solicitante.datos_basicos.cedula_pasaporte\")\r\n\
  \turl = '/service/bdin_contraloria_resumen_descuentos/where.json?Cedula=' + \"#{ci}\"\r\n\
  \t\r\n\
  \t# Se obtienen los datos para la b\xC3\xBAsqueda por rango de fecha - LG\r\n\
  \r\n\
  \t# Datos para fecha de inicio de b\xC3\xBAsqueda\r\n\
  \tquincena_desde = form_data.get(\"periodo_de_descuento_consultado.desde.quincena\")\r\n\
  \r\n\
  \t# Si se selecciona la primera quincena, el d\xC3\xADa de inicio ser\xC3\xA1 el 1; si se selecciona la segunda quincena el d\xC3\xADa ser\xC3\xA1 el 15.\r\n\
  \tif quincena_desde == \"1a\"\r\n\
  \t\t_dia_inicio = \"01\"\r\n\
  \telse\r\n\
  \t\t_dia_inicio = \"15\"\r\n\
  \tend\r\n\
  \r\n\
  \tmes_desde = form_data.get(\"periodo_de_descuento_consultado.desde.meses\")\r\n\
  \tcase mes_desde\r\n\
  \t\twhen \"Enero\"\r\n\
  \t\t\t_mes_inicio = \"01\"\r\n\
  \t\twhen \"Febrero\"\r\n\
  \t\t\t_mes_inicio = \"02\"\r\n\
  \t\twhen \"Marzo\"\r\n\
  \t\t\t_mes_inicio = \"03\"\r\n\
  \t\twhen \"Abril\"\r\n\
  \t\t\t_mes_inicio = \"04\"\r\n\
  \t\twhen \"Mayo\"\r\n\
  \t\t\t_mes_inicio = \"05\"\r\n\
  \t\twhen \"Junio\"\r\n\
  \t\t\t_mes_inicio = \"06\"\r\n\
  \t\twhen \"Julio\"\r\n\
  \t\t\t_mes_inicio = \"07\"\r\n\
  \t\twhen \"Agosto\"\r\n\
  \t\t\t_mes_inicio = \"08\"\r\n\
  \t\twhen \"Septiembre\"\r\n\
  \t\t\t_mes_inicio = \"09\"\r\n\
  \t\twhen \"Octubre\"\r\n\
  \t\t\t_mes_inicio = \"10\"\r\n\
  \t\twhen \"Noviembre\"\r\n\
  \t\t\t_mes_inicio = \"11\"\r\n\
  \t\telse\r\n\
  \t\t\t_mes_inicio = \"12\"\r\n\
  \tend\r\n\
  \r\n\
  \tanio_desde = form_data.get(\"periodo_de_descuento_consultado.desde.anio\")\r\n\
  \t_fecha_inicio = _dia_inicio + \"-\" + _mes_inicio + \"-\" + anio_desde\r\n\
  \t\t\r\n\
  \t# Datos para fecha de fin de b\xC3\xBAsqueda\r\n\
  \tquincena_hasta = form_data.get(\"periodo_de_descuento_consultado.hasta.quincena\")\r\n\
  \tif quincena_hasta == \"1a\"\r\n\
  \t\t\t_dia_fin = \"01\"\r\n\
  \telse\r\n\
  \t\t\t_dia_fin = \"15\"\r\n\
  \tend\r\n\
  \r\n\
  \tmes_hasta = form_data.get(\"periodo_de_descuento_consultado.hasta.meses\")\r\n\
  \tcase mes_hasta\r\n\
  \t\twhen \"Enero\"\r\n\
  \t\t  _mes_fin = \"01\"\r\n\
  \t\twhen \"Febrero\"\r\n\
  \t\t  _mes_fin = \"02\"\r\n\
  \t\twhen \"Marzo\"\r\n\
  \t\t  _mes_fin = \"03\"\r\n\
  \t\twhen \"Abril\"\r\n\
  \t\t  _mes_fin = \"04\"\r\n\
  \t\twhen \"Mayo\"\r\n\
  \t\t  _mes_fin = \"05\"\r\n\
  \t\twhen \"Junio\"\r\n\
  \t\t  _mes_fin = \"06\"\r\n\
  \t\twhen \"Julio\"\r\n\
  \t\t  _mes_fin = \"07\"\r\n\
  \t\twhen \"Agosto\"\r\n\
  \t\t  _mes_fin = \"08\"\r\n\
  \t\twhen \"Septiembre\"\r\n\
  \t\t  _mes_fin = \"09\"\r\n\
  \t\twhen \"Octubre\"\r\n\
  \t\t  _mes_fin = \"10\"\r\n\
  \t\twhen \"Noviembre\"\r\n\
  \t\t  _mes_fin = \"11\"\r\n\
  \t\telse\r\n\
  \t\t  _mes_fin = \"12\"\r\n\
  \tend\r\n\
  \r\n\
  \tanio_hasta = form_data.get(\"periodo_de_descuento_consultado.hasta.anio\")\r\n\
  \t_fecha_fin = _dia_fin + \"-\" + _mes_fin + \"-\" + anio_hasta\r\n\
  \r\n\
  \turl = \"#{url}\" + \"&Fecha_Inicio=#{_fecha_inicio}&Fecha_Fin=#{_fecha_fin}\"\r\n\
  \t\r\n\
  \t\r\n\
  \tif anio_desde.to_i>1999 || anio_hasta.to_i > 1999\r\n\
  \t\t\r\n\
  \t\tresult = WebserviceConsumer.get(url).parsed_response\r\n\
  \t\tresult = result[\"response\"]\r\n\
  \t\tif !result.empty?\r\n\
  \t\t\t_data = { 'config' => {\r\n            \"readonly\" => \"true\",\r\n            \"select_type\" => \"checkbox\"\r\n\
  \t\t\t},\r\n\
  \t\t\t'data' => result,\r\n\
  \t\t\t'citizen_selection' => [],\r\n\
  \t\t\t'agent_selection' => []\r\n\
  \t\t\t}\r\n\
  \r\n\
  \t\t\t_data = ActiveSupport::JSON.encode(_data)\r\n\
  \t\t\tform_data.set(\"descuentos.automatico.fieldgrid\", _data)\t\r\n\
  \t\telse\r\n\
  \t\t\ttransition_errors << \"Su consulta no gener\xC3\xB3 resultados.Favor modificar los criterios de la busqueda y vuelva  a intentarlo.\"\r\n\
  \t\tend\t\r\n\
  \telse\r\n\
  \t\tform_data.set(\"tipo_de_descuento.descuento_manual.mensaje\",\"MENSAJE:\\nEl per\xC3\xADodo que ingres\xC3\xB3 es menor al a\xC3\xB1o 1999 por lo tanto no existen agentes crediticios cargados en la base de datos del sistema.\\n \\nFavor cont\xC3\xADnue al pr\xC3\xB3ximo paso.\")\r\n\
  \tend\r\n\
  \t\r\n\
  \tform_data.set(\"clave_de_descuento_resumen.agentes_financieros.clave_de_descuento\", \"\")"
views: 
back_step: Paso 1 - Datos del Solicitante
next_step: Paso 3 - Clave de Descuento
position: 2
ajax_calls: |-
  $(document)
  
  $(document).ready(function(){
  fields = [
  "field_periodo_de_descuento_consultado_desde_quincena",
  "field_periodo_de_descuento_consultado_desde_meses",
  "field_periodo_de_descuento_consultado_desde_anio",
  "field_periodo_de_descuento_consultado_hasta_quincena",
  "field_periodo_de_descuento_consultado_hasta_meses",
  "field_periodo_de_descuento_consultado_hasta_anio",
  "field_agente_financiero_datos_del_agente_financiero_categoria",
  "field_agente_financiero_datos_del_agente_financiero_agente_financiero",
  "field_entidad_donde_se_labora_instance__institucion_de_descuento_entidades_cgr",
  "field_entidad_donde_se_labora_instance__institucion_de_descuento_planilla",
  "field_entidad_donde_se_labora_instance__institucion_de_descuento_posicion",
  ];
  showOnTable(fields,5,"Detalles de la Solicitud");
  });
