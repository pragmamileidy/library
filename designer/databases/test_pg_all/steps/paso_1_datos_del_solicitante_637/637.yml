--- 
id: 637
name: Paso 1 - Datos del Solicitante
label: Solicitante
description: "Informaci\xC3\xB3n del solicitante de la certificaci\xC3\xB3n de descuento"
fill_step_id: 330
created_at: 2012-06-20 14:41:08 Z
updated_at: 2014-08-19 21:11:44 Z
include: "{\"1512\":{\"1725\":{\"1973\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1883\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"1726\":{\"585\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"631\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"2298\":{\"1725\":{\"1973\":{\"views\":\"default\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,close,close_and_save,save
on_becoming: |
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud",@application["created_at"])
  result = WebserviceConsumer.get('/consecutive/generador_cgr_descuentos/generate.json').parsed_response
  _consecutivo = result["response"]
  _consecutivo = "#{@application["id"]}-"+"#{_consecutivo["value"]}"
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud",_consecutivo)
  
  _nombre= "#{@owner["first_name"]} "+"#{@owner["second_name"]} "+"#{@owner["last_name"]} "+"#{@owner["second_last_name"]} "+"#{@owner["married_name"]}"
  form_data.set("solicitante.datos_basicos.nombre_completo", _nombre)
  form_data.set("solicitante.datos_basicos.cedula_pasaporte",  "#{@owner["national_id"]}"+"#{@owner["passport"]}")
  form_data.set("solicitante.datos_basicos.segundo_nombre", @owner["second_name"])
  form_data.set("solicitante.direccion_actual.numero_de_telefono", @owner["fixed_number"])
  form_data.set("solicitante.direccion_actual.numero_celular", @owner["movil_number"])

on_transition: |-
  _person = @application["person_id"]
  _owner = @application["owner_person_id"]
  if _person != _owner
  _nro_documento = form_data.get("representante_del_solicitante.datos_basicos.cedula_pasaporte")
  result = WebserviceConsumer.get( '/service/bdin_tribunal_electoral/find.json?cedula=' + "#{_nro_documento}").parsed_response
  representante = result["response"]
  
  		if result["response"].nil? 
  			transition_errors << "Los datos del representante no fueron encontrados, por favor verifique."
  		else
  
  _nombre= "#{representante["primerNombre"]} "+"#{representante["primerApellido"]} "+"#{representante["segundoApellido"]} "
  form_data.set("representante_del_solicitante.datos_basicos.nombre_completo", _nombre)
  #form_data.set("representante_del_solicitante.direccion_actual.numero_de_telefono", representante["tlfLocal"])
  #form_data.set("representante_del_solicitante.direccion_actual.numero_celular", representante["tlfCelular"])
  end
  end
views: 
back_step: ""
next_step: Paso 2 -  Detalle de la solicitud
position: 1
ajax_calls: "$( function() {\r\n  $(\"div\").each (function(){\r\n                               //alert($(this).html().trim());\r\n              if ($(this).html().trim() == \"Direcci\xC3\xB3n Actual *\") {   // aqu\xC3\xAD colocas el nombre que deseas cambiar\r\n                      //alert( \"hola\");\r\n                      $(this).html(\"Telefonos\");                    // Aqu\xC3\xAD colocas el Nombre que deseas que se muestre\r\n                              \r\n              }\r\n      \r\n      });\r\n                  \r\n                });\r\n\
  \r\n"
