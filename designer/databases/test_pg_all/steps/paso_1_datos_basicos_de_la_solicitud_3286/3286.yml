--- 
id: 3286
name: Paso 1 - Datos Basicos de la Solicitud
label: "<strong style=\"color:#900C3F\"> Datos B\xC3\xA1sicos de la Solicitud </strong>"
description: "<br><strong style=\"color:#FF5733\"> Por favor introduzca la informaci\xC3\xB3n solicitada.</strong>\r\n\
  \r\n"
fill_step_id: 1765
created_at: 2017-01-04 18:41:32.132384 Z
updated_at: 2017-02-22 14:54:43.191290 Z
include: "{\"5189\":{\"3654\":{\"4081\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"4082\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"5153\":{\"3208\":{\"3716\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"1973\":{\"views\":\"only_view\",\"enabled\":\"enabled\"}},\"3269\":{\"210\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"3294\":{\"210\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"3271\":{\"210\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"3272\":{\"210\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"3273\":{\"210\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"5158\":{\"1710\":{\"1401\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}}},\"5159\":{\"1710\":{\"1401\":{\"views\":\"only_view\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"only_view\",\"enabled\":\"disabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,close,close_and_save,save
on_becoming: |
  #::::: Obtener numero consecutivo y crear consecutivo de tramite
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud",@application["created_at"])
  if form_data.get("informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud").blank?
    result = WebserviceConsumer.get( '/consecutive/generador_dij/generate.json').parsed_response
    consecutivo = result["response"]
    consecutivo = "#{@application["id"]}-"+"#{consecutivo["value"]}"
    form_data.set("informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud",consecutivo)
  end
  
  ##LP: Setear motivo trabajo si en PN
  form_data.set("tipo_de_solicitud_dij.tipo_de_solicitud_dij.motivo_de_la_solicitud_dij","Trabajo")
  form_data.set("tipo_de_solicitud_dij.tipo_de_solicitud_dij.tipo_de_solicitud_dij","Laboral")
  
  _person = @application["person_id"]
  _owner = @application["owner_person_id"]
  if @owner["kind_of_user_type"] == "NaturalPerson"
    if _person == _owner
      tipodoc = !@owner["national_id"].blank? ? "Cedula" : "Pasaporte"
      numdoc = !@owner["national_id"].blank? ? @owner["national_id"] : @owner["passport"]
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.tipo_de_documento",tipodoc)
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.cedula_pasaporte",numdoc)
    end
  end
  

on_transition: |-
  #:::::DV:  UN SOLO TITULAR - OnTransition Paso 1:::::#
  _person = @application["person_id"]
  _owner = @application["owner_person_id"]
  if @owner["kind_of_user_type"] == "NaturalPerson"
    if _person == _owner
      tipodoc = !@owner["national_id"].blank? ? "Cedula" : "Pasaporte"
      numdoc = !@owner["national_id"].blank? ? @owner["national_id"] : @owner["passport"]
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.tipo_de_documento",tipodoc)
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.cedula_pasaporte",numdoc)
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.primer_nombre",@owner["first_name"])
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.segundo_nombre",@owner["second_name"])
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.primer_apellido",@owner["last_name"])
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.segundo_apellido",@owner["second_last_name"])
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.apellido_de_casada",@owner["married_name"])
      sexo = ((@owner["gender"] == "female")) ? "Femenino" : "Masculino"
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.sexo",sexo)
      form_data.set("datos_del_titular_rp.datos_de_ubicacion.direccion",@owner["full_address"])
      form_data.set("datos_del_titular_rp.datos_de_ubicacion.numero_de_telefono",@owner["fixed_number"])
      form_data.set("datos_del_titular_rp.datos_de_ubicacion.correo_electronico",@owner["email"])
      form_data.set("datos_del_titular_rp.datos_del_padre.documento_hijo",numdoc)
      form_data.set("datos_del_titular_rp.datos_de_la_madre.documento_hijo",numdoc)
      
      #::: CONVERSION FECHA DE NACIEMIENTO :::#
      fecha = @owner["birthday"]
      fecha_n = Time.parse(fecha).strftime("%d-%m-%Y")
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.fecha_de_nacimiento",fecha_n)
      #::: CALCULA EDAD :::#
      edad = ((Date.today - fecha.to_date).to_f / 365).to_i
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.edad",edad)
  
      #:::: USADO PARA PRINT DESIGN
      primerNombret = form_data.get("datos_del_titular_rp.datos_basicos_de_persona_natural.primer_nombre")
      segundoNombret = form_data.get("datos_del_titular_rp.datos_basicos_de_persona_natural.segundo_nombre")
      primerApellidot = form_data.get("datos_del_titular_rp.datos_basicos_de_persona_natural.primer_apellido")
      segundoApellidot = form_data.get("datos_del_titular_rp.datos_basicos_de_persona_natural.segundo_apellido")
      apellidoCasadat = form_data.get("datos_del_titular_rp.datos_basicos_de_persona_natural.apellido_de_casada")
      nombreCompletot = "#{primerNombret} #{segundoNombret} #{primerApellidot} #{segundoApellidot} #{apellidoCasadat}"
      form_data.set("datos_del_titular_rp.datos_basicos_de_persona_natural.nombre_completo",nombreCompletot.squish)
  
      #:::: CODIGO UNICO PARA TITULAR
      co_result = WebserviceConsumer.default_get( '/consecutive/codigo_unico_dij/generate.json').parsed_response
      cod_unico = co_result["response"]
      cod_unico = cod_unico["value"]
      form_data.set("datos_del_titular_rp.codigo_unico_dij.codigo_unico",cod_unico)
  
      #:::: GENERA CONSECUTIVO INDIVIDUAL
      form_data.set("datos_del_titular_rp.datos_de_solicitud.fecha_de_solicitud",@application["created_at"])
      result_cons = WebserviceConsumer.default_get( '/consecutive/generador_dij_f2/generate.json').parsed_response
      consecut = result_cons["response"]
      consecut = "#{@application["id"]}-"+"#{consecut["value"]}"
      form_data.set("datos_del_titular_rp.datos_de_solicitud.numero_de_solicitud",consecut)
    end
  end
views: 
back_step: ""
next_step: "Paso 2 - Confirmaci\xC3\xB3n"
position: 1
ajax_calls: "$(document).ready(function(){\r\n  $(\"#field_datos_del_titular_rp_datos_basicos_de_persona_natural_tipo_de_documento\").parents(\".part-box\").hide();\r\n  $( function() {\r\n    $(\"span\").each (function(){\r\n      if ($(this).html().trim() == \"Secci\xC3\xB3n: Datos del Solicitante\") {  \r\n        $(this).html(\"Gesti\xC3\xB3n de Solicitud\"); \r\n      }\r\n    });\r\n  });\r\n\
  \r\n  $( function() {\r\n    $(\"span\").each (function(){\r\n      if ($(this).html().trim() == \"Datos de la Persona\") {  \r\n        $(this).html(\"\"); \r\n      }\r\n    });\r\n  });\r\n\
  \r\n  $( function() {\r\n    var hint = \"Favor  adjuntar archivo correspondiente\";\r\n      $(\"div\").each (function(){\r\n      if ($(this).html().trim() == hint) {  \r\n        $(this).html(hint).css({'color':'#088A08','font-weight':'bold'}); \r\n      }\r\n    });\r\n  })\r\n\
  \r\n  $( function() {\r\n    $(\"span\").each (function(){\r\n      if ($(this).html().trim() == \"Secci\xC3\xB3n: Datos del Titular\") {  \r\n        $(this).html(\"Adjuntos requeridos\"); \r\n      }\r\n    });\r\n  });\r\n\
  \r\n  $( function() {\r\n    $(\"span\").each (function(){\r\n      if ($(this).html().trim() == \"Secci\xC3\xB3n: Recepci\xC3\xB3n Ventanilla \xC3\x9Anica\") {  \r\n        $(this).html(\"Recepci\xC3\xB3n Ventanilla \xC3\x9Anica\"); \r\n      }\r\n    });\r\n  });\r\n\
  });"
