--- 
id: 2958
name: Paso 1 - Datos del Autor y Titular
label: Solicitud de datos del Autor (es) o Titular (es)
description: ""
fill_step_id: 1589
created_at: 2014-10-09 21:37:42 Z
updated_at: 2014-12-02 20:30:55 Z
include: "{\"4549\":{\"3141\":{\"3601\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3602\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3603\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"4606\":{\"1710\":{\"1401\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"disabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,close,close_and_save,save
on_becoming: |-
  #::::::Inicializacion de Datos Generales:::::#
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud",@application["created_at"])
  result = WebserviceConsumer.get( '/consecutive/generador_modificacionobras/generate.json').parsed_response
  _consecutivo = result["response"]
  _consecutivo = "#{@application["id"]}-"+"#{_consecutivo["value"]}"
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud",_consecutivo)
on_transition: "#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::#\r\n\
  #:::::::INTEGRACI\xC3\x93N PARA OBTENER LOS DATOS DEL AUTOR, FillStep Paso 1 - On Transition :::::::::::#\r\n\
  #:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::#\r\n\
  (1..6).each do |_num|\r\n\
  \ttipo_doc = form_data.get(\"tipo_de_documento_mici_instance_#{_num}.tipo_documento_mici.tipo_de_documento\")\r\n\
  \tnro_documento = form_data.get(\"tipo_de_documento_mici_instance_#{_num}.tipo_documento_mici.no_documento\")\r\n\
  \tform_data.set(\"datos_de_autores_instance_#{_num}.tipo_de_identificacion.tipo_identificacion_texto\", tipo_doc)\r\n\
  \tif tipo_doc != \"RUC\"\t\r\n\
  \t\tif tipo_doc == \"C\xC3\xA9dula\"\t\r\n\
  \t\t\tresult = WebserviceConsumer.get('/service/bdin_tribunal_electoral/find.json?cedula=' + \"#{nro_documento}\").parsed_response\r\n\
  \t\t\tdatos = result[\"response\"]\r\n\
  \t\t\tif !datos.blank?\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_persona.cedula_pasaporte\",nro_documento)\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_persona.primer_nombre\",datos[\"primerNombre\"])\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_persona.primer_apellido\",datos[\"primerApellido\"])\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_persona.segundo_nombre\",datos[\"segundoNombre\"])\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_persona.segundo_apellido\",datos[\"segundoApellido\"])\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_persona.nacionalidad\",datos[\"pais\"])\r\n\
  \t\t\t\tfechaNac = datos[\"fechaNacimiento\"].to_s\r\n\
  \t\t\t\tedad = ((Date.today - fechaNac.to_date).to_f / 365).to_i\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_persona.fecha_de_nacimiento\",fechaNac)\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_persona.edad\",edad)\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.informacion_de_residencia_localizacion.direccion\", datos[\"direccion\"])\r\n\
  \t\t\tend\r\n\
  \t\t\tif datos.blank?\r\n\
  \t\t\t\ttransition_errors << \"La c\xC3\xA9dula suministrada no existe en el sistema, favor revise  el n\xC3\xBAmero especificado en el autor  \" + \"#{_num}\"\r\n\
  \t\t\tend\r\n\
  \t\tend\r\n\
  \tend\r\n\
  \r\n\
  \tif tipo_doc == \"Pasaporte\"  \r\n\
  \t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_persona.cedula_pasaporte\",nro_documento)\r\n\
  \tend\t\r\n\
  \r\n\
  \tif tipo_doc == \"RUC\"\r\n\
  \t\ttipoSoc = form_data.get(\"tipo_de_documento_mici_instance_#{_num}.tipo_documento_mici.tipo_sociedad\") \t\r\n\
  \t\tif !nro_documento.blank?\r\n\
  \t\t\tresult = WebserviceConsumer.get(URI.escape('/service/bdin_registro_publico_ruc/find.json?ruc=' + \"#{nro_documento}\" + '&tipo_sociedad=' + \"#{tipoSoc}\")).parsed_response\r\n\
  \t\t\tdata = result[\"response\"]  \r\n\
  \t\t\tif !data.blank?\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_empresa.nombre_comercial\",data[\"nombre_empresa\"])\t\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_empresa.tipo_sociedad\",tipoSoc)\r\n\
  \t\t\t\tform_data.set(\"datos_de_autores_instance_#{_num}.datos_de_la_empresa.ruc\",data[\"ruc\"])\r\n\
  \t\t\telse\r\n\
  \t\t\t\ttransition_errors << \"El ruc introducido no esta registrado en el sistema o tiene tipo de sociedad incorrecta, por favor verifique: #{nro_documento}\"\r\n\
  \t\t\tend\r\n\
  \t\tend\r\n\
  \tend\r\n\
  \tif tipo_doc == \"\"\r\n\
  \t\tform_data.set(\"datos_de_autores_instance_#{_num}.tipo_de_identificacion.tipo_identificacion_texto\", \"\")\r\n\
  \tend\t \r\n\
  \t                       \r\n\
  end"
views: 
back_step: ""
next_step: Paso 2 - Datos del Autores o Titulares
position: 1
ajax_calls: "//:::::::::::::Ocultar Campo \"Tipo de Sociedad al Seleccionar Tipo de Documento C\xC3\xA9dula o Pasaporte:::::::://\r\n\
  \r\n\
  $.each( $('[id*=field_tipo_de_documento_mici_]'), function(index, campo) {\r\n\
  \tocultarcampos(this.value,this.id);\r\n\
  \tif ($(campo).attr('id').match(/tipo_documento_mici_tipo_de_documento/)) {\r\n\
  \t\t$(campo).attr('onchange', 'ocultarcampos(this.value,this.id);')\r\n\
  \t}\r\n\
  }); \r\n\
  \r\n\
  function ocultarcampos(valorcampo, idcampo) {\r\n\
  \tvar coincide = idcampo.match(/[\\d]_tipo_documento_mici_tipo_de_documento/);\r\n\
  \tvar pos = \"\";\r\n\
  \tif (coincide != undefined) {\r\n\
  \t\tpos = coincide[0].split('_');\r\n\
  \t\tvar inicioRuta   = \"#field_tipo_de_documento_mici_instance_\";\r\n\
  \t\tvar campoTipoDoc = \"_tipo_documento_mici_tipo_de_documento\";\r\n\
  \t\tvar campoTipoSoc = \"_tipo_documento_mici_tipo_sociedad\";\r\n\
  \t\tvar Sociedad = inicioRuta + pos[0] + campoTipoSoc;\r\n\
  \r\n\
  \t\tif (valorcampo == \"\") {\r\n\
  \t\t\t$(Sociedad).parent().parent().hide();\r\n\
  \t\t\t$(Sociedad).val(\"\");\r\n\
  \t\t} else if (valorcampo == \"C\xC3\xA9dula\" || valorcampo == \"Pasaporte\") {\r\n\
  \t\t\t$(Sociedad).parent().parent().hide();\r\n\
  \t\t} else {\r\n\
  \t\t\t$(Sociedad).parent().parent().show();\r\n\
  \t\t}\r\n\
  \t}       \r\n\
  }\r\n\
  \r\n\
  $(document).ready(function(){\r\n\
  \t$.each( $('[id*=tipo_de_documento_mici_]'), function(index, campo) {\t\r\n\
  \t\tvar pos = (this.id).match(/_instance_[\\d][\\d]/);\r\n\
  \t\tif (pos == null){\r\n\
  \t\t  pos = (this.id).match(/_instance_[\\d]/);\r\n\
  \t\t}\r\n\
  \t\tvar iniciorut = \"#field_tipo_de_documento_mici\";\r\n\
  \t\tvar tDoc = \"_tipo_documento_mici_tipo_de_documento\";\r\n\
  \t\tvar nDoc = \"_tipo_documento_mici_no_documento\";\r\n\
  \t\tvar coincide = iniciorut.concat(pos);\r\n\
  \t\tvar TiDoc = coincide.concat(tDoc);\r\n\
  \t\tvar NroDocu = coincide.concat(nDoc);\r\n\
  \t\t$(TiDoc).change(function(){\r\n\
  \t\t\tTiDoc = $(this).val();\r\n\
  \t\t\tif(TiDoc == \"C\xC3\xA9dula\"){\r\n\
  \t\t\t\t$(NroDocu).val(\"\");\r\n\
  \t\t\t}\r\n\
  \t\t\tif(TiDoc == \"Pasaporte\"){\r\n\
  \t\t\t\t$(NroDocu).val(\"\");\r\n\
  \t\t\t}\r\n\
  \t\t\tif(TiDoc == \"RUC\"){\r\n\
  \t\t\t\t$(NroDocu).val(\"\");\r\n\
  \t\t\t}\r\n\
  \t\t});\t\r\n\
  \t});\r\n\
  });"
