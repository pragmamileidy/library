--- 
id: 3105
name: Paso 1 - Datos del Solicitante
label: Datos del Solicitante
description: Datos del Solicitante
fill_step_id: 1660
created_at: 2015-02-16 21:30:41 Z
updated_at: 2015-02-19 21:10:50 Z
include: "{\"4788\":{\"3460\":{\"3867\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3868\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3885\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4766\":{\"3378\":{\"2198\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"4780\":{\"3447\":{\"2198\":{\"views\":\"default\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,back_steps,next_steps,close,close_and_save,save
on_becoming: |
  #CONSECUTIVO#
  
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud",@application["created_at"])
  result = WebserviceConsumer.get( '/consecutive/generador_afiliacion_atencion_servicios_medicos/generate.json').parsed_response
  _consecutivo = result["response"]
  _consecutivo = "#{@application["id"]}-"+"#{_consecutivo["value"]}"
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud",_consecutivo)
  
  #muestra de los datos del usuario que ingreso #
  
   form_data.set("datos_del_usuario.datos_de_usuario_afiliacion.nombre", @owner["name"])  
   form_data.set("datos_del_usuario.datos_de_usuario_afiliacion.numero_de_identificacion", @owner["national_id"])
   form_data.set("datos_del_usuario.datos_de_usuario_afiliacion.email", @owner["email"])

on_transition: |-
  #Obtener los Datos del Solicitante - Datos del Solicitante   #
  
  nro_documento = form_data.get("datos_del_solicitante_richard.datos_del_solicitante.numero_de_identificacion")
  result = WebserviceConsumer.get('/service/bdin_tribunal_electoral/find.json?cedula=' + "#{nro_documento}").parsed_response
  data = result["response"] # datos = result["response"]
  if !data.nil?   # if datos.blank? 
         form_data.set("datos_del_solicitante_richard.datos_del_solicitante.numero_de_identificacion",data["cedula"])
         form_data.set("datos_del_solicitante_richard.datos_del_solicitante.primer_nombre",data["primerNombre"])
         form_data.set("datos_del_solicitante_richard.datos_del_solicitante.segundo_nombre",data["segundoNombre"])
         form_data.set("datos_del_solicitante_richard.datos_del_solicitante.primer_apellido",data["primerApellido"])
         form_data.set("datos_del_solicitante_richard.datos_del_solicitante.segundo_apellido",data["segundoApellido"])
         form_data.set("datos_del_solicitante_richard.datos_del_solicitante.edad",data["edad"]) 
         form_data.set("datos_del_solicitante_richard.datos_del_solicitante.lugar_de_nacimiento",data["lugarNacimiento"])
         form_data.set("datos_del_solicitante_richard.datos_del_solicitante.sexo",data["sexo"])
         form_data.set("datos_del_solicitante_richard.datos_del_solicitante.fecha_de_nacimiento",data["fechaNacimiento"])
         form_data.set("datos_del_solicitante_richard.datos_de_ubicacion.pais_string",data["pais"])
         form_data.set("datos_del_solicitante_richard.datos_de_ubicacion.provincia",data["provincia"])
         form_data.set("datos_del_solicitante_richard.datos_de_ubicacion.distrito",data["distrito"])
         form_data.set("datos_del_solicitante_richard.datos_de_ubicacion.corregimiento",data["corregimiento"])
         form_data.set("datos_del_solicitante_richard.datos_de_ubicacion.numero_de_casa_apartamento",data["nroCasaApartamento"])
         form_data.set("datos_del_solicitante_richard.datos_de_ubicacion.numero_de_telefono",data["tlfLocal"])
         form_data.set("datos_del_solicitante_richard.datos_de_ubicacion.correo_electronico",data["email"])
  
  else
  	transition_errors << "Los datos del solicitante no fueron encontrados, por favor verifique e intente nuevamente."
  end
  
  
  
  # Obtener los Datos del Solicitante - Datos del Conyugue #
  
  nro_documento = form_data.get("datos_del_conyugue.datos_del_conyugue.numero_de_identificacion")
  result = WebserviceConsumer.get('/service/bdin_tribunal_electoral/find.json?cedula=' + "#{nro_documento}").parsed_response
  data = result["response"] # datos = result["response"]
  if !data.nil?   # if datos.blank? 
         form_data.set("datos_del_conyugue.datos_del_conyugue.numero_de_identificacion",data["cedula"])
         form_data.set("datos_del_conyugue.datos_del_conyugue.primer_nombre",data["primerNombre"])
         form_data.set("datos_del_conyugue.datos_del_conyugue.segundo_nombre",data["segundoNombre"])
         form_data.set("datos_del_conyugue.datos_del_conyugue.primer_apellido",data["primerApellido"])
         form_data.set("datos_del_conyugue.datos_del_conyugue.segundo_apellido",data["segundoApellido"])
         form_data.set("datos_del_conyugue.datos_del_conyugue.edad",data["edad"]) 
         form_data.set("datos_del_conyugue.datos_del_conyugue.lugar_de_nacimiento",data["lugarNacimiento"])
         form_data.set("datos_del_conyugue.datos_del_conyugue.sexo",data["sexo"])
         form_data.set("datos_del_conyugue.datos_del_conyugue.fecha_de_nacimiento",data["fechaNacimiento"])
         form_data.set("datos_del_conyugue.datos_de_ubicacion.pais_string",data["pais"])
         form_data.set("datos_del_conyugue.datos_de_ubicacion.provincia",data["provincia"])
         form_data.set("datos_del_conyugue.datos_de_ubicacion.distrito",data["distrito"])
         form_data.set("datos_del_conyugue.datos_de_ubicacion.corregimiento",data["corregimiento"])
         form_data.set("datos_del_conyugue.datos_de_ubicacion.numero_de_casa_apartamento",data["nroCasaApartamento"])
         form_data.set("datos_del_conyugue.datos_de_ubicacion.numero_de_telefono",data["tlfLocal"])
         form_data.set("datos_del_conyugue.datos_de_ubicacion.correo_electronico",data["email"])
  
  else
  	transition_errors << "Los datos del conyugue no fueron encontrados, por favor verifique e intente nuevamente."
  end
views: 
back_step: ""
next_step: Paso 2 - Datos del Solicitante
position: 1
ajax_calls: ""
