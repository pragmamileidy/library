--- 
id: 3039
name: "Paso 1- Datos del Usuario "
label: "Datos del Usuario "
description: ""
fill_step_id: 1626
created_at: 2014-12-04 21:03:07 Z
updated_at: 2014-12-08 20:17:27 Z
include: "{\"4621\":{\"3409\":{\"760\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"761\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"762\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4623\":{\"3390\":{\"2945\":{\"views\":\"default\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,close,close_and_save,save
on_becoming: |
  # Inicializacion de datos generales
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud",@application["created_at"])
  result = WebserviceConsumer.get( '/consecutive/generador_subsidio_lentes/generate.json').parsed_response
  _consecutivo = result["response"]
  _consecutivo = "#{@application["id"]}-"+"#{_consecutivo["value"]}"
  form_data.set("informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud",_consecutivo)
  
  
   form_data.set("datos_del_usuario.informacion_de_usuario.nombre_cuenta", @owner["name"])  
   form_data.set("datos_del_usuario.informacion_de_usuario.numero_de_identificacion", @owner["national_id"])  
   form_data.set("datos_del_usuario.informacion_de_usuario.usuario", @owner["email"])

on_transition: "cedula = form_data.get(\"datos_del_asegurado.datos_personales.identificacion\")\r\n\
  \r\n\
  result = WebserviceConsumer.get('/service/bdin_tribunal_electoral/find.json?cedula=' + \"#{cedula}\").parsed_response\r\n nose = result[\"response\"]\r\n\
  if !nose.nil?\r\n\
  \t\r\n\
  \tform_data.set(\"datos_del_asegurado.datos_personales.identificacion\",nose[\"cedula\"])\r\n\
  \tform_data.set(\"datos_del_asegurado.datos_personales.primer_nombre\",nose[\"primerNombre\"])\r\n    form_data.set(\"datos_del_asegurado.datos_personales.segundo_nombre\",nose[\"segundoNombre\"])\r\n\
  \tform_data.set(\"datos_del_asegurado.datos_personales.primer_apellido\",nose[\"primerApellido\"])\r\n\
  \tform_data.set(\"datos_del_asegurado.datos_personales.segundo_apellido\",nose[\"segundoApellido\"])\r\n\
  \tform_data.set(\"datos_del_asegurado.datos_personales.apellido_de_casada\",nose[\"apellidoCasada\"])\r\n    form_data.set(\"datos_del_asegurado.datos_personales.numero_de_telefono\",nose[\"tlfLocal\"])\r\n    form_data.set(\"datos_del_asegurado.datos_personales.sexo\",nose[\"sexo\"])\r\n\
  else \r\n\
  \ttransition_errors << \"La c\xC3\xA9dula suministrada no existe en el sistema, favor revisar\" \r\n\
  \r\n\
  end\r\n \r\n                 \r\n\
  \r\n\
  \r\n"
views: 
back_step: ""
next_step: Paso 2 - Datos del Asegurado
position: 1
ajax_calls: ""
