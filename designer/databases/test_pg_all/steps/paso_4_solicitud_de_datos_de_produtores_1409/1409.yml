--- 
id: 1409
name: Paso 4 - Solicitud de Datos de Produtores
label: Solicitud de Datos de Produtores
description: ""
fill_step_id: 577
created_at: 2013-05-21 18:54:50 Z
updated_at: 2014-04-30 14:14:27 Z
include: "{\"4313\":{\"3141\":{\"3601\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3602\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3603\":{\"views\":\"default\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,back,next,back_steps,next_steps,close,close_and_save,save
on_becoming: ""
on_transition: "(1..5).each do |_num|\r\n\
  \t_tipo = form_data.get(\"tipo_de_documento_productor_instance_#{_num}.tipo_documento_mici.tipo_de_documento\")\r\n\
  \tif _tipo == \"C\xC3\xA9dula\"\r\n\
  \t\tnro_documento = form_data.get(\"tipo_de_documento_productor_instance_#{_num}.tipo_documento_mici.no_documento\")\r\n\
  \t\tif !nro_documento.blank?\r\n\
  \t\t\tresult = WebserviceConsumer.get( '/service/bdin_tribunal_electoral/find.json?cedula=' + \"#{nro_documento}\").parsed_response\r\n\
  \t\t\tdatos = result[\"response\"]\r\n\
  \t\t\tif datos.nil? \r\n\
  \t\t\t\tform_data.set(\"tipo_de_documento_productor_instance_#{_num}.tipo_documento_mici.no_documento\",\"\")\r\n\
  \t\t\t\ttransition_errors << \"Los datos del Productor #{_num} no se encuentran en el sistema\"\r\n\
  \t\t\telse\r\n\
  \t\t\t\t_tipo = form_data.get(\"tipo_de_documento_productor_instance_#{_num}.tipo_documento_mici.tipo_de_documento\")\r\n\
  \t\t\t\tform_data.set(\"datos_del_productor_persona_natural_instance_#{_num}.datos_de_la_persona.tipo_documento_string\",_tipo)\r\n\
  \t\t\t\tform_data.set(\"datos_del_productor_persona_natural_instance_#{_num}.datos_de_la_persona.cedula_pasaporte\",nro_documento)\r\n\
  \t\t\t\tform_data.set(\"datos_del_productor_persona_natural_instance_#{_num}.datos_de_la_persona.primer_nombre\",datos[\"primerNombre\"])\r\n\
  \t\t\t\tform_data.set(\"datos_del_productor_persona_natural_instance_#{_num}.datos_de_la_persona.primer_apellido\",datos[\"primerApellido\"])\r\n\
  \t\t\t\tform_data.set(\"datos_del_productor_persona_natural_instance_#{_num}.datos_de_la_persona.segundo_nombre\",datos[\"segundoNombre\"])\r\n\
  \t\t\t\tform_data.set(\"datos_del_productor_persona_natural_instance_#{_num}.datos_de_la_persona.segundo_apellido\",datos[\"segundoApellido\"])\r\n\
  \r\n                        #Usado para print design\r\n\
  \t\t\tsegundoNombre = form_data.get(\"datos_del_productor_persona_natural_instance_#{_num}.datos_de_la_persona.segundo_nombre\")\r\n\
  \t\t\tapellidoCasada = form_data.get(\"datos_del_productor_persona_natural_instance_#{_num}.datos_de_la_persona.apellido_de_casada\")\r\n\
  \t\t\t\t\t\t\r\n\
  \t\t\t_nombre =  \"#{datos[\"primerNombre\"]} \"+\"#{segundoNombre} \"+\"#{datos[\"primerApellido\"]} \"+\"#{datos[\"segundoApellido\"]} \"+\"#{apellidoCasada}\"\r\n\
  \t\t\tform_data.set(\"datos_del_productor_persona_natural_instance_#{_num}.datos_de_la_persona.nombre_completo\",_nombre)\r\n\
  \t\t\t\tdatos = nil\r\n\
  \t\t\tend\r\n\
  \t\tend\r\n\
  \tend\r\n\
  \t\r\n\
  \tif _tipo == \"Pasaporte\"\r\n\
  \t\t\tnro_documento = form_data.get(\"tipo_de_documento_productor_instance_#{_num}.tipo_documento_mici.no_documento\")\r\n\
  \t\t\tform_data.set(\"datos_del_productor_persona_natural_instance_#{_num}.datos_de_la_persona.cedula_pasaporte\",nro_documento)\r\n\
  \t\t\t\r\n\
  \t\t\tdocumen = form_data.get(\"tipo_de_documento_productor_instance_#{_num}.tipo_documento_mici.tipo_de_documento\")\r\n\
  \t\t\tform_data.set(\"datos_del_productor_persona_natural_instance_#{_num}.datos_de_la_persona.tipo_documento_string\", documen)\r\n\
  \tend\r\n\
  \t\r\n\
  \tif _tipo == \"RUC\" \r\n\
  \t\ttipoSoc=form_data.get(\"tipo_de_documento_productor_instance_#{_num}.tipo_documento_mici.tipo_sociedad\")\r\n\
  \t\tnro_documento = form_data.get(\"tipo_de_documento_productor_instance_#{_num}.tipo_documento_mici.no_documento\")\r\n\
  \t\r\n\
  \t   if !nro_documento.blank?\r\n\
  \t\t\tresult = WebserviceConsumer.get(URI.escape('/service/bdin_registro_publico_ruc/find.json?ruc=' + \"#{nro_documento}\" + '&tipo_sociedad=' + \"#{tipoSoc}\")).parsed_response\r\n\
  \t\t\tdata = result[\"response\"]\r\n\
  \t\t\tif data.nil?\r\n\
  \t\t\t\ttransition_errors << \"El ruc del Productor #{_num}, no esta registrado en el sistema o tiene tipo de sociedad incorrecta, por favor verifique\"\r\n\
  \t\t\t\telse\r\n                                        _tipo = form_data.get(\"tipo_de_documento_productor_instance_#{_num}.tipo_documento_mici.tipo_de_documento\")\r\n                                        form_data.set(\"datos_del_productor_persona_juridica_instance_#{_num}.datos_personales.tipo_documento\",_tipo)\r\n\
  \r\n\
  \t\t\t\t\tform_data.set(\"datos_del_productor_persona_juridica_instance_#{_num}.datos_personales.tipo_sociedad\",tipoSoc)\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_productor_persona_juridica_instance_#{_num}.datos_personales.ruc\",nro_documento)\r\n\
  \t\t\t\t\tform_data.set(\"datos_del_productor_persona_juridica_instance_#{_num}.datos_personales.nombre\",data[\"nombre_empresa\"])\r\n\
  \t\t\t\t\tdatos = nil\r\n\
  \t\t\tend\r\n\
  \t\tend\r\n\
  \tend\r\n\
  end\r\n"
views: 
back_step: Paso 3 - Datos de la Obra
next_step: Paso 5 - Datos de Produtores
position: 4
ajax_calls: "//deshabilitar tipo desociedad\r\n\
  \r\n\
  $.each( $('[id*=field_tipo_de_documento_productor_]'), function(index, campo) {\r\n \r\n if ($(campo).attr('id').match(/tipo_documento_mici_tipo_de_documento/)) {\r\n  $(campo).attr('onchange', 'evalua(this.value,this.id);')\r\n }\r\n\
  \r\n  });  \r\n\
  \r\n\
  function evalua(productor,idsociedad) {\r\n\
  \r\n var pos = idsociedad.match(/[\\d]/);\r\n var mod1 = \"#field_tipo_de_documento_productor_instance_\";\r\n var mod2 = \"_tipo_documento_mici_tipo_de_documento\";\r\n var mod4 = \"_tipo_documento_mici_tipo_sociedad\";\r\n var mod5 = \"_tipo_documento_mici_no_documento\";\r\n  var mod3 = mod1.concat(pos);\r\n var tipo_s = mod3.concat(mod4);\r\n var tipo_d = mod3.concat(mod2);\r\n var num = mod3.concat(mod5);\r\n $(tipo_s).attr(\"disabled\",\"disabled\");\r\n        if (($(tipo_d).val() == 'C\xC3\xA9dula')||($(tipo_d).val() == 'Pasaporte')){\r\n      $(tipo_s).attr(\"disabled\",\"disabled\");\r\n\
  \t$(tipo_s).val('');\r\n\
  \t$(num).val('');\r\n  }  \r\n  else {\r\n      $(tipo_s).removeAttr(\"disabled\",\"disabled\");\r\n   $(tipo_s).val(''); \r\n   $(num).val('');\r\n  }\r\n\
  }"
