--- 
id: 2926
name: Paso 1- Recepcion de la Solicitud
label: "Recepci\xC3\xB3n de la Solicitud"
description: "Recepci\xC3\xB3n de la Solicitud"
fill_step_id: 1567
created_at: 2014-06-28 14:25:15 Z
updated_at: 2014-06-28 14:25:15 Z
include: "{\"4410\":{\"3208\":{\"1973\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1469\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1470\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1471\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1472\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1473\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1474\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1475\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1477\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1476\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1479\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3694\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3209\":{\"572\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"805\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"585\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"594\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4411\":{\"2631\":{\"567\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"566\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3254\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2632\":{\"805\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"585\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"594\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4412\":{\"1444\":{\"528\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"529\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"530\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"537\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4413\":{\"1444\":{\"528\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"529\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"530\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"537\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"926\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4414\":{\"3210\":{\"3628\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3211\":{\"3627\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3213\":{\"2929\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2930\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4415\":{\"3212\":{\"3629\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4417\":{\"3261\":{\"3691\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3693\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3692\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4419\":{\"3214\":{\"210\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3215\":{\"210\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3216\":{\"210\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3217\":{\"210\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3218\":{\"210\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3219\":{\"210\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3220\":{\"210\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3221\":{\"210\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3222\":{\"210\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3259\":{\"210\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4422\":{\"1710\":{\"1401\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1891\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4423\":{\"1710\":{\"1402\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1891\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4425\":{\"1710\":{\"1401\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3199\":{\"views\":\"default\",\"enabled\":\"enabled\"}}},\"4426\":{\"1710\":{\"1401\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"3199\":{\"views\":\"default\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,close,close_and_save,save
on_becoming: |
  _idagente = @task["agent_id"].to_s
  
                  result = WebserviceConsumer.get( '/preconfigured_services/get_user_info.xml?agent_id=' + "#{_idagente}" + '&include_all=true').parsed_response
                  _hash = result["hash"]
                  _agente = _hash["response"]
  
  
                  form_data.set("recibido_por.datos_del_funcionario_generico.usuario", _agente["name"])
                  form_data.set("recibido.datos_del_funcionario_generico.usuario", _agente["name"])

on_transition: "###Buscar si existe el la BD de DIJ###\r\n\
  ##Persona Natural\r\n\
  if @owner[\"kind_of_user_type\"] == \"NaturalPerson\"\t\r\n\
  \t\tif @owner[\"natural_person_type\"]==\"national_citizen\"\r\n\
  \t\t\t#nro_documento=@owner[\"national_id\"]\r\n\
  \t\t\tnro_documento=form_data.get(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.cedula_pasaporte\")\r\n            result = WebserviceConsumer.get('/service/bdin_dij_record_policivo/find.json?tipoDocumento=CIP&nroDocumento=' + \"#{nro_documento}\").parsed_response\r\n            _solicitante = result[\"response\"]\r\n\
  \t\t\tif _solicitante.blank?\r\n                 ##Mostrar secci\xC3\xB3n de confirmacion \"Los datos del solicitante no fueron encontrados en la BD del DIJ, por favor realice el registro del solicitante.\"\r\n\
  \t\t\t\t dato1=\"No\"\r\n\
  \t\t\t\t form_data.set(\"mensaje_dij.mensaje_dij.existe\",dato1)\r\n\
  \t\t\t\telse\r\n\
  \t\t\t\t dato1=\"S\xC3\xAD\"\r\n\
  \t\t\t\t form_data.set(\"mensaje_dij.mensaje_dij.existe\",dato1)\r\n            end\r\n\
  \t\telse\r\n\
  \t\t\tnro_documento=@owner[\"passport\"]\r\n\
  \t\t\tnro_documento=form_data.get(\"datos_del_solicitante_dij_instance_1.datos_basicos_de_persona_natural.cedula_pasaporte\")\r\n\
  \t\t\tresult = WebserviceConsumer.get('/service/bdin_dij_record_policivo/find.json?tipoDocumento=PAS&nroDocumento=' + \"#{nro_documento}\").parsed_response\r\n\
  \t\t\t_solicitante = result[\"response\"]\r\n\
  \t\t\tif _solicitante.blank?\r\n                ##Mostrar secci\xC3\xB3n de confirmacion \"Los datos del solicitante no fueron encontrados en la BD del DIJ, por favor realice el registro del solicitante.\"\r\n\
  \t\t\t\tdato1=\"No\"\r\n\
  \t\t\t\t form_data.set(\"mensaje_dij.mensaje_dij.existe\",dato1)\r\n\
  \t\t\t\t else\r\n\
  \t\t\t\t dato1=\"S\xC3\xAD\"\r\n\
  \t\t\t\t form_data.set(\"mensaje_dij.mensaje_dij.existe\",dato1)\r\n\
  \t\t\tend\r\n\
  \t\tend\t\r\n\
  end\r\n\
  ###Persona Jur\xC3\xADdica###\r\n\
  if  @owner[\"kind_of_user_type\"] == \"JuridicalPerson\"\r\n\
  \t\ttipo_pj= form_data.get(\"tipo_de_persona_dij.tipo_de_solicitante_juridico.tipo_de_solicitante_juridico\")\r\n\
  \tif tipo_pj==\"Autoridades y Empresas\"\r\n\
  \t#tipodocumento[]\r\n\
  \t#nrodocumento[]\r\n\
  \t#nombre[]\r\n\
  \t#apellido[]\r\n\
  \tdato1=\"S\xC3\xAD\"\r\n\
  \t\t(1..20).each do |x|\r\n\
  \t\t\ttipo_documento= form_data.get(\"tipo_de_persona_dij.tipo_de_identificacion_instance_#{x}.tipo_identificacion\")\r\n\
  \t\t\tnro_documento=form_data.get(\"tipo_de_persona_dij.tipo_de_identificacion_instance_#{x}.numero_documento\")\r\n\
  \t\t\tif ( !nro_documento.blank? && !tipo_documento.blank?)\r\n\
  \t\t\t\tif tipo_documento==\"Cedula\"\r\n\
  \t\t\t\t\t\tresult = WebserviceConsumer.get('/service/bdin_dij_record_policivo/find.json?tipoDocumento=CIP&nroDocumento=' + \"#{nro_documento}\").parsed_response\r\n\
  \t\t\t\t\t\t_solicitante = result[\"response\"]\r\n\
  \t\t\t\t\t\tif _solicitante.blank?\r\n\
  \t\t\t\t\t\t\t ##Mostrar secci\xC3\xB3n de confirmacion \"Los datos del solicitante no fueron encontrados en la BD del DIJ, por favor realice el registro del solicitante.\"\r\n\
  \t\t\t\t\t\t\t dato1=\"No\"\r\n\
  \t\t\t\t\t\t\t existe=\"No\"\r\n\
  \t\t\t\t\t\t\t form_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_de_ubicacion.otro\",existe)\r\n\
  \t\t\t\t\t\t\t\t#nrodocumento<<form_data.get(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.cedula_pasaporte\")\r\n\
  \t\t\t\t\t\t\t\t#tipodocumento<<form_data.get(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.tipo_documento\")\r\n\
  \t\t\t\t\t\t\t\t#nombre<<form_data.get(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.primer_nombre\")\r\n\
  \t\t\t\t\t\t\t\t#apellido<<form_data.get(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.primer_apellido\")\r\n\
  \t\t\t\t\t\tend\r\n\
  \t\t\t\t else                                   \r\n\
  \t\t\t\t\t\tresult = WebserviceConsumer.get('/service/bdin_dij_record_policivo/find.json?tipoDocumento=PAS&nroDocumento=' + \"#{nro_documento}\").parsed_response\r\n\
  \t\t\t\t\t\t_solicitante = result[\"response\"]\r\n\
  \t\t\t\t\t\tif _solicitante.blank?\r\n\
  \t\t\t\t\t\t\t ##Mostrar secci\xC3\xB3n de confirmacion \"Los datos del solicitante no fueron encontrados en la BD del DIJ, por favor realice el registro del solicitante.\"\r\n\
  \t\t\t\t\t\t\t dato1=\"No\"\r\n\
  \t\t\t\t\t\t\t existe=\"No\"\r\n\
  \t\t\t\t\t\t\t form_data.set(\"datos_del_solicitante_dij_instance_#{x}.datos_de_ubicacion.otro\",existe)\r\n\
  \t\t\t\t\t\t\t\t#nrodocumento<<form_data.get(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.cedula_pasaporte\")\r\n\
  \t\t\t\t\t\t\t\t#tipodocumento<<form_data.get(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.tipo_documento\")\r\n\
  \t\t\t\t\t\t\t\t#nombre<<form_data.get(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.primer_nombre\")\r\n\
  \t\t\t\t\t\t\t\t#apellido<<form_data.get(\"datos_del_solicitante_dij_instance_#{x}.datos_basicos_de_persona_natural.primer_apellido\")\r\n\
  \t\t\t\t\t\tend\r\n\
  \t\t\t\tend\t\r\n\
  \t\t\tend\t\t\r\n\
  \t\tend\r\n\
  \t\tform_data.set(\"mensaje_dij.mensaje_dij.existe\",dato1)\r\n\
  \t\tform_data.set(\"confirmacion_dij.confirmacion_dij.dato_existe\",dato1)\r\n\
  \t\t###Cargar y mostrar tabla de Solicitantes no registrdos en la BD de DIJ###\r\n\
  \tend\r\n\
  end\r\n\
  \r\n\
  \r\n\
  ##### RECEPCION DE SOLICITUD #####\r\n\
  _obs = form_data.get(\"recibido_por.datos_del_funcionario_generico.observaciones\")\r\n\
  if _obs.blank?\r\n\
  \t_obs = form_data.get(\"recibido.datos_del_funcionario_generico.observaciones\")\r\n\
  end\r\n\
  \r\n\
  _eval = form_data.get(\"recibido_por.datos_del_funcionario_generico.evaluacion\")\r\n\
  if _eval.blank?\r\n\
  \t_eval = form_data.get(\"recibido.datos_del_funcionario_generico.evaluacion_ok_rechazo\")\r\n\
  end\r\n\
  \r\n\
  \r\n\
  if (_eval ==\"REPARO\" and _obs.blank?) \r\n\
  \ttransition_errors << \"Debe indicar el motivo del reparo en el campo (Observaci\xC3\xB3n). \"\r\n\
  end\r\n\
  \r\n\
  if (_eval ==\"RECHAZO\" and _obs.blank?) \r\n\
  \ttransition_errors << \"Debe indicar el motivo del rechazo en el campo (Observaci\xC3\xB3n). \"\r\n\
  end"
views: 
back_step: ""
next_step: ""
position: 1
ajax_calls: ""
