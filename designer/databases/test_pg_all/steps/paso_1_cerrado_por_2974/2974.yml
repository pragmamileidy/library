--- 
id: 2974
name: Paso 1 - Cerrado por
label: Cerrado por
description: Cerrado por
fill_step_id: 1597
created_at: 2014-10-10 15:58:15 Z
updated_at: 2015-03-11 19:44:38 Z
include: "{\"4515\":{\"1780\":{\"1612\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4516\":{\"1811\":{\"1688\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4518\":{\"1791\":{\"1983\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1657\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1658\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1659\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1660\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1661\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4523\":{\"1811\":{\"1881\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4524\":{\"1791\":{\"1983\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1657\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1658\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1659\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1660\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1661\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4526\":{\"674\":{\"782\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"124\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"783\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"126\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"939\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"940\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2055\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"947\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"948\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1100\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1465\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1362\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1386\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1387\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4528\":{\"1791\":{\"3116\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1983\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1657\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1658\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1659\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1660\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1661\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4530\":{\"1823\":{\"1706\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1707\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4531\":{\"1812\":{\"1689\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2068\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2069\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"2070\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1690\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1694\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"2794\":{\"3210\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3211\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3212\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3213\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3214\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"3215\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4534\":{\"1864\":{\"1764\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1765\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"1867\":{\"1764\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1765\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"1868\":{\"1764\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1765\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"1869\":{\"1764\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1765\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"1870\":{\"1764\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1765\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"1871\":{\"1764\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1765\":{\"views\":\"default\",\"enabled\":\"disabled\"}},\"3443\":{\"3205\":{\"views\":\"default\",\"enabled\":\"enabled\"}},\"3045\":{\"210\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4540\":{\"1710\":{\"1401\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"disabled\"}}},\"4541\":{\"1710\":{\"1401\":{\"views\":\"default\",\"enabled\":\"disabled\"},\"1402\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"1891\":{\"views\":\"default\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,close,close_and_save,save,submit
on_becoming: |
  # Inicializacion de datos del agente - LG
  
  _idagente = @task["agent_id"].to_s
  
  result = WebserviceConsumer.get( '/preconfigured_services/get_user_info.xml?agent_id=' + "#{_idagente}" + '&include_all=true').parsed_response
  _hash = result["hash"]
  _agente = _hash["response"]
  
  
  form_data.set("cierre_de_funcionario.datos_del_funcionario_generico.usuario", _agente["name"])

on_transition: "#:::::::::::::::::::::::::::::::::::::::::::::::::::#\r\n\
  #::::::::::::Verificaci\xC3\xB3n de Traspaso:::::::::::::::#\r\n\
  #:::::::::::::::::::::::::::::::::::::::::::::::::::#\r\n\
  aprueba = form_data.get(\"cierre_de_funcionario.datos_del_funcionario_generico.aprobacion\")\r\n\
  if aprueba == \"S\xC3\x8D\"\r\n\
  \tplaca = form_data.get(\"datos_del_vehiculo.datos_de_vehiculo.placa\")\r\n\
  \tnumDocAdquiriente = form_data.get(\"datos_del_propietario_del_vehiculo_persona_natural.nombres_completos.cedula_pasaporte\")\r\n\
  \tresult = WebserviceConsumer.get('/service/bdin_attt_vehiculo_consulta_vehiculo_por_placa/find.json?placa=' + \"#{placa}\").parsed_response\r\n\
  \tvehiculo = result[\"response\"]\r\n\
  \tnuevoPropietario = vehiculo[\"cedula\"]\r\n\
  \tif (numDocAdquiriente != nuevoPropietario)\r\n\
  \t\ttransition_errors << \"No se puede aprobar la solicitud de Traspaso de Veh\xC3\xADculo, ya que no se ha actualizado la informaci\xC3\xB3n del nuevo propietario. Por favor vuelva a intentarlo\"\r\n\
  \tend\r\n\
  end\r\n"
views: 
back_step: ""
next_step: ""
position: 0
ajax_calls: |
  $('#field_anexos_mensaje_cargo').parent().parent().hide();

