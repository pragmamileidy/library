--- 
id: 17
name: Paso 1 - Consulta de Infracciones
label: Consulta de Infracciones
description: ""
fill_step_id: 9
created_at: 2017-02-22 14:43:37.174942 Z
updated_at: 2017-02-22 14:43:37.315923 Z
include: "{\"48\":{\"19\":{\"68\":{\"views\":\"only_view\",\"enabled\":\"enabled\"},\"3\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"4\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"71\":{\"views\":\"default\",\"enabled\":\"enabled\"},\"51\":{\"views\":\"hidden\",\"enabled\":\"enabled\"}}}}"
allowed_next_to_steps: ""
allowed_back_to_steps: ""
controls: ,next,close,close_and_save,save,print_form
on_becoming: "form_data.set(\"es_deudor_o_no.datos_de_la_persona.dato_a_consultar\",\"\")\r\n\
  form_data.set(\"es_deudor_o_no.datos_de_la_persona.cedula\",\"\")\r\n\
  \r\n\
  \r\n\
  #::: Generador de Consecutivos :::#\r\n\
  form_data.set(\"informacion_de_solicitud.datos_de_la_solicitud.fecha_de_solicitud\",@application[\"created_at\"])\r\n\
  result = WebserviceConsumer.get('/consecutive/generador_pagoboletas/generate.json').parsed_response\r\n\
  _consecutivo = result[\"response\"]\r\n\
  _consecutivo = \"#{@application[\"id\"]}-\"+\"#{_consecutivo[\"value\"]}\"\r\n\
  form_data.set(\"informacion_de_solicitud.datos_de_la_solicitud.numero_de_solicitud\",_consecutivo)\r\n\
  \r\n\
  infraccion_propia = form_data.get(\"es_deudor_o_no.datos_de_la_persona.tipo_documento\")\r\n\
  if (infraccion_propia.blank?)\r\n    form_data.set(\"es_deudor_o_no.datos_de_la_persona.infraccion_propia\",\"Si\")\r\n    #::: Llenado de Datos del Solicitante\r\n    #::: DV: Modificada sentencia 04/10/2016 Datos del Solcitante o Representante legal\r\n    _person = @application[\"person_id\"]\r\n    _owner = @application[\"owner_person_id\"]\r\n    if @owner[\"kind_of_user_type\"] == \"NaturalPerson\"\r\n        if _person == _owner\r\n            tipodoc = !@owner[\"national_id\"].blank? ? \"C\xC3\xA9dula\" : \"Pasaporte\"\r\n            numdoc = !@owner[\"national_id\"].blank? ? @owner[\"national_id\"] : @owner[\"passport\"]\r\n            form_data.set(\"es_deudor_o_no.datos_de_la_persona.tipo_documento\",tipodoc)\r\n            form_data.set(\"datos_de_la_persona.datos_de_la_persona.nro_de_documento\",numdoc)\r\n            form_data.set(\"es_deudor_o_no.datos_de_la_persona.cedula\",numdoc)\r\n    \r\n            nombre = @owner[\"first_name\"]+\" \"+@owner[\"second_name\"]+\" \"+@owner[\"last_name\"]+\" \"+@owner[\"second_last_name\"]\r\n            form_data.set(\"es_deudor_o_no.datos_de_la_persona.nombre_completo\",nombre)\r\n        else\r\n            _idpersona = @application[\"person_id\"].to_s\r\n            result = WebserviceConsumer.get( '/preconfigured_services/get_user_info.xml?person_id=' + \"#{_idpersona}\" + '&include_all=true').parsed_response\r\n            _hash = result[\"hash\"]\r\n            _persona = _hash[\"response\"]\r\n            tdoc = _persona [\"person_gov_id_type\"] == \"national_id\" ? \"C\xC3\xA9dula\" : \"Pasaporte\"\r\n            form_data.set(\"datos_de_la_persona.representante.tipo_de_documento\",tdoc)\r\n            form_data.set(\"datos_de_la_persona.representante.nro_de_documento\", _persona[\"person_gov_id_number\"])\r\n            form_data.set(\"datos_de_la_persona.representante.nombre_completo\", _persona[\"name\"])\r\n    \r\n            tipodoc = !@owner[\"national_id\"].blank? ? \"C\xC3\xA9dula\" : \"Pasaporte\"\r\n            numdoc = !@owner[\"national_id\"].blank? ? @owner[\"national_id\"] : @owner[\"passport\"]\r\n            form_data.set(\"datos_de_la_persona.datos_de_la_persona.tipo_documento_persona_natural\",tipodoc)\r\n            form_data.set(\"datos_de_la_persona.datos_de_la_persona.nro_de_documento\",numdoc)\r\n            #form_data.set(\"es_deudor_o_no.es_deudor_o_no.nro_doc\",numdoc)\r\n            form_data.set(\"es_deudor_o_no.datos_de_la_persona.dato_a_consultar\",numdoc)\r\n            nombre = @owner[\"first_name\"]+\" \"+@owner[\"second_name\"]+\" \"+@owner[\"last_name\"]+\" \"+@owner[\"second_last_name\"]\r\n            form_data.set(\"datos_de_la_persona.datos_de_la_persona.nombre_completo\",nombre)\r\n        end\r\n    end\r\n    \r\n    #::: DV: 04/10/2016 Datos del Solcitante Juridico o Representante legal\r\n    if @owner[\"kind_of_user_type\"] == \"JuridicalPerson\"\r\n        form_data.set(\"datos_de_la_empresa.datos_de_la_empresa.nro_de_ruc\",@owner[\"tax_id\"])\r\n        form_data.set(\"es_deudor_o_no.datos_de_la_persona.nombre_completo\",@owner[\"name\"])\r\n        form_data.set(\"es_deudor_o_no.datos_de_la_persona.dato_a_consultar\",@owner[\"tax_id\"])\r\n        form_data.set(\"es_deudor_o_no.datos_de_la_persona.tipo_documento\",\"RUC\")\r\n    \r\n        _idpersona = @application[\"person_id\"].to_s\r\n        result = WebserviceConsumer.get( '/preconfigured_services/get_user_info.xml?person_id=' + \"#{_idpersona}\" + '&include_all=true').parsed_response\r\n        _hash = result[\"hash\"]\r\n        _persona = _hash[\"response\"]\r\n        tdoc = _persona [\"person_gov_id_type\"] == \"national_id\" ? \"C\xC3\xA9dula\" : \"Pasaporte\"\r\n        form_data.set(\"datos_de_la_empresa.representante.tipo_de_documento\",tdoc)\r\n        form_data.set(\"datos_de_la_empresa.representante.nro_de_documento\", _persona[\"person_gov_id_number\"])\r\n        form_data.set(\"datos_de_la_empresa.representante.nombre_completo\", _persona[\"name\"])\r\n    end \r\n\
  else\r\n    form_data.set(\"es_deudor_o_no.datos_de_la_persona.infraccion_propia\",\"\")\r\n\
  end"
on_transition: "## MODIFICADO  10-02-2017 MT: Esto debido a que incialmente el valor a buscar en el servicio \r\n\
  # proxy_bdin_pago_boletas_attt era el numero  del solicitante, sin importar que se cambiara desde \r\n\
  #el principio.. Por ello se decidio pasar esta validacion al ON BECOMING del segundo paso, donde \r\n\
  # solo se extraera la informacion hallada en el campo  es_deudor_o_no.datos_de_la_persona.dato_a_consultar\r\n\
  \r\n\
  #::: Obtener los datos a consultar :::#\r\n\
  #::: Si el deudor es el solicitante :::#\r\n\
  #if form_data.get(\"es_deudor_o_no.datos_de_la_persona.infraccion_propia\") == \"Si\"\r\n\
  #    _person = @application[\"person_id\"]\r\n\
  #    _owner = @application[\"owner_person_id\"]\r\n\
  #    if @owner[\"kind_of_user_type\"] == \"NaturalPerson\"\r\n\
  #        if _person == _owner\r\n\
  #            tipodDoc = !@owner[\"national_id\"].blank? ? \"CIP\" : \"PAS\"\r\n\
  #            tipoDoc = !@owner[\"national_id\"].blank? ? \"C\xC3\xA9dula\" : \"Pasaporte\"\r\n\
  #            nro_doc = !@owner[\"national_id\"].blank? ? @owner[\"national_id\"] : @owner[\"passport\"]\r\n\
  #        end\r\n\
  #    else\r\n\
  #       tipodDoc = \"RUC\"\r\n\
  #       tipoDoc = \"RUC\"\r\n\
  #       nro_doc = @owner[\"tax_id\"]\r\n\
  #    end\r\n\
  #    form_data.set(\"es_deudor_o_no.datos_de_la_persona.tipo_documento\",tipoDoc)\r\n\
  #    form_data.set(\"es_deudor_o_no.datos_de_la_persona.dato_a_consultar\",nro_doc)\r\n\
  #else\r\n\
  #    #::: Si los deudores son otros :::#                            \r\n\
  #    tipo_docD = form_data.get(\"es_deudor_o_no.datos_de_la_persona.tipo_documento\")\r\n\
  #    if tipo_docD == \"C\xC3\xA9dula\"\r\n\
  #        tipodDoc = \"CIP\"\r\n\
  #    end\r\n\
  #    if tipo_docD == \"Pasaporte\"\r\n\
  #        tipodDoc = \"PAS\"\r\n\
  #    end\r\n\
  #    if tipo_docD == \"Placa\"\r\n\
  #        tipodDoc = \"PLACA\"\r\n\
  #    end\r\n\
  #    if tipo_docD == \"RUC\"\r\n\
  #        tipodDoc = \"RUC\"\r\n\
  #    end\r\n\
  #    nro_doc = form_data.get(\"es_deudor_o_no.datos_de_la_persona.dato_a_consultar\")\r\n\
  #end"
views: 
back_step: ""
next_step: Paso 2 - Datos de Boletas Pendientes de Pago
position: 1
ajax_calls: "//::: DV: Validaci\xC3\xB3n para ocultar seccion de confirmaci\xC3\xB3n si y motivo de solicitud\r\n\
  /* $(document).ready(function(){\r\n  var valor = $('input[name=\"[field][es_deudor_o_no_datos_de_la_persona_infraccion_propia]\"]:checked').val();\r\n  if(valor == undefined){\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_tipo_documento').parents(\".field-box\").hide();\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").hide();\r\n  }\r\n\
  });\r\n\
  \r\n\
  //::: DV: Funci\xC3\xB3n para ocultar campo de deudores ::://\r\n\
  $(document).ready(function(){\r\n  $(function() {\r\n    $('input[name=\"[field][es_deudor_o_no_datos_de_la_persona_infraccion_propia]\"]').change(function() {\r\n      if ($('input[name=\"[field][es_deudor_o_no_datos_de_la_persona_infraccion_propia]\"]:checked').val() == \"No\"){\r\n        $('#field_es_deudor_o_no_datos_de_la_persona_tipo_documento').parents(\".field-box\").show();\r\n        $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").show();\r\n        $('#field_es_deudor_o_no_datos_de_la_persona_tipo_documento').val(\"\");\r\n        $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').val(\"\");\r\n      }else{\r\n        $('#field_es_deudor_o_no_datos_de_la_persona_tipo_documento').parents(\".field-box\").hide();\r\n        $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").hide();\r\n      }\r\n    });\r\n  });\r\n\
  \r\n  //::: Mantener los datos entre pasos ::://\r\n  if ($('input[name=\"[field][es_deudor_o_no_datos_de_la_persona_infraccion_propia]\"]:checked').val() == \"No\"){\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_tipo_documento').parents(\".field-box\").show();\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").show();\r\n  }else if ($('input[name=\"[field][es_deudor_o_no_datos_de_la_persona_infraccion_propia]\"]:checked').val() == \"Si\"){\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_tipo_documento').parents(\".field-box\").hide();\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").hide();\r\n  }else{\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_tipo_documento').parents(\".field-box\").hide();\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").hide();\r\n  }\r\n\
  }); */\r\n\
  \r\n\
  //::: Limpiar nro de documento cuando se cambia de tipo ::://\r\n\
  $(document).ready(function(){\r\n   TiDoc = $('#field_es_deudor_o_no_datos_de_la_persona_tipo_documento');\r\n  if ($(TiDoc).find(':selected').val() == \"C\xC3\xA9dula\"){\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_cedula').parents(\".field-box\").show();\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").hide();\r\n  }else{\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_cedula').parents(\".field-box\").hide();\r\n    $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").show();\r\n  }\r\n  $('#field_es_deudor_o_no_datos_de_la_persona_infraccion_propia').parents(\".field-box\").hide();\r\n  $( function() {\r\n      TiDoc.change(function() {\r\n        if ($(TiDoc).find(':selected').val() == \"\") {\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').val(\"\");\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_cedula').val(\"\");\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_cedula').parents(\".field-box\").hide();\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").show();\r\n        }\r\n        if ($(TiDoc).find(':selected').val() == \"C\xC3\xA9dula\") {\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').val(\"\");\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_cedula').val(\"\");\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_cedula').parents(\".field-box\").show();\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").hide();\r\n        }\r\n        if ($(TiDoc).find(':selected').val() == \"Pasaporte\") {\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').val(\"\");\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_cedula').val(\"\");\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_cedula').parents(\".field-box\").hide();\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").show();\r\n        }\r\n        if ($(TiDoc).find(':selected').val() == \"RUC\") {\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').val(\"\");\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_cedula').val(\"\");\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_cedula').parents(\".field-box\").hide();\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").show();\r\n        }\r\n         if ($(TiDoc).find(':selected').val() == \"Placa\") {\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').val(\"\");\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_cedula').val(\"\");\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_cedula').parents(\".field-box\").hide();\r\n          $('#field_es_deudor_o_no_datos_de_la_persona_dato_a_consultar').parents(\".field-box\").show();\r\n        }\r\n    }); \r\n  });    \r\n\
  });\r\n\
  \r\n\
  //::: DV: Cambiar nombre secci\xC3\xB3n y color  paso 1::://\r\n\
  $(document).ready(function(){  \r\n  $( function() {\r\n    $(\"div\").each (function(){\r\n      if ($(this).html().trim() == \"Secci\xC3\xB3n: Datos de la Consulta\") {  \r\n        $(this).html(\"Datos de la Consulta\"); \r\n      }\r\n    });\r\n  });\r\n\
  \r\n  $( function() {\r\n    var hint = \"Datos de la Consulta\";\r\n    $(\"div\").each (function(){\r\n      if ($(this).html().trim() == hint) {  \r\n        $(this).html(hint).css({'color':'#0F698D','font-weight':'bold'}); \r\n      }\r\n    });\r\n  })\r\n\
  });\r\n\
  \r\n\
  \r\n\
  $(document).ready(function(){\r\n  // VDIAZ - cambios de presentaci\xC3\xB3n\r\n  // elimina el boton de maximizar    \r\n  $(\".panel-control-fullscreen2\").remove();\r\n\
  });"
